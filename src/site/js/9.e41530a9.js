(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"2WF7":function(e,t,n){},BIOR:function(e,t,n){},KD3M:function(e,t,n){"use strict";var a=n("BIOR"),i=n.n(a);i.a},"MEv/":function(e,t,n){"use strict";var a=n("2WF7"),i=n.n(a);i.a},QM0R:function(e,t,n){"use strict";var a=n("19FS"),i=function(e,t){return e?a["format"](e,t):"-"};t["a"]=i},uwlH:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"subaccount--useage-pane"},[n("div",{staticClass:"common-top-nav-row"},[n("el-select",{attrs:{size:"small",placeholder:"请选择角色"},model:{value:e.role,callback:function(t){e.role=t},expression:"role"}},[n("el-option",{attrs:{label:"全部角色",value:""}}),e._l(e.rolelist,function(e){return n("el-option",{key:e.value,attrs:{label:e.name,value:e.name}})})],2),n("el-input",{staticStyle:{width:"200px",display:"inline-block"},attrs:{placeholder:"登录账号"},model:{value:e.loginName,callback:function(t){e.loginName=t},expression:"loginName"}}),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(t){e.getOrganizationSubAccounts(1,e.pager.size)}}},[e._v("搜索")]),e.access.add?n("el-button",{staticClass:"confirm-button plus-button",attrs:{size:"small"},on:{click:e.openAddUserPopup}},[e._v("添加子账户")]):e._e()],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.users,border:""}},[n("el-table-column",{attrs:{prop:"loginName",label:"登录账号","min-width":"1"}}),n("el-table-column",{attrs:{prop:"name",label:"姓名","min-width":"1"}}),n("el-table-column",{attrs:{label:"角色类型","min-width":"2"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.roleBeans.map(function(e){return e.name}).join(","))+"\n      ")]}}])}),n("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"1"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.multipleRoles(t.row))+"\n      ")]}}])}),n("el-table-column",{attrs:{prop:"lastLoginOn",label:"最后登录时间","min-width":"1"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e._f("time")(t.row.lastLoginOn,"yyyy-MM-dd HH:mm:ss")))])]}}])}),n("el-table-column",{attrs:{label:"状态","min-width":"1"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.userStatus||"-")+"\n      ")]}}])}),n("el-table-column",{attrs:{label:"操作","min-width":"2"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[n("el-button",{attrs:{type:"text",disabled:t.row.id===e.organization.adminClient||t.row.id===e.user.id},on:{click:function(n){e.openEditUserPopup(t.row)}}},[e._v("修改")]),n("el-button",{attrs:{type:"text",disabled:t.row.id===e.organization.adminClient||t.row.id===e.user.id},on:{click:function(n){e.openDeleteUserPopup(t.row)}}},[e._v("删除")]),n("el-button",{attrs:{type:"text"},on:{click:function(n){e.openResetPasswordPopup(t.row)}}},[e._v("重置密码")])],1)]}}])})],1),n("el-pagination",{attrs:{background:"","current-page":e.pager.index,"page-sizes":[10,20,30,40,50],layout:"total, sizes,prev, pager, next,jumper","page-size":e.pager.size,total:e.pager.total},on:{"size-change":function(t){return e.getOrganizationSubAccounts(1,t)},"current-change":function(t){return e.getOrganizationSubAccounts(t,e.pager.size)}}}),n("el-dialog",{attrs:{"show-close":"",title:null==e.userPopup.id?"添加子账户":"修改",visible:e.userPopup.visible,width:"500px",left:""},on:{close:function(t){e.userPopup.visible=!1}}},[n("div",{staticStyle:{width:"80%",margin:"0 auto"}},[n("el-form",{ref:"userForm",attrs:{model:e.userPopup,rules:e.rules,"label-width":"70px"},on:{validate:e.onValidate}},[n("el-form-item",{attrs:{label:"登录账号",prop:"loginName"}},[n("el-input",{attrs:{disabled:null!=e.userPopup.id,placeholder:"请输入登录账号"},model:{value:e.userPopup.loginName,callback:function(t){e.$set(e.userPopup,"loginName",t)},expression:"userPopup.loginName"}})],1),null==e.userPopup.id?n("el-form-item",{attrs:{label:"初始密码",required:""}},[n("el-input",{attrs:{value:e.userPopup.loginName+"123",placeholder:"初始密码",disabled:""}})],1):e._e(),n("el-form-item",{attrs:{label:"姓名",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.userPopup.name,callback:function(t){e.$set(e.userPopup,"name",t)},expression:"userPopup.name"}})],1),n("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[n("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.userPopup.mobile,callback:function(t){e.$set(e.userPopup,"mobile",t)},expression:"userPopup.mobile"}})],1),n("el-form-item",{attrs:{label:"电子邮箱",prop:"email"}},[n("el-input",{attrs:{placeholder:"请输入电子邮箱"},model:{value:e.userPopup.email,callback:function(t){e.$set(e.userPopup,"email",t)},expression:"userPopup.email"}})],1),n("el-form-item",{attrs:{label:"角色",prop:"roles"}},[n("el-select",{ref:"roles",staticStyle:{width:"100%"},attrs:{size:"medium",multiple:"",placeholder:"请选择角色"},on:{blur:e.onRolesBlur},model:{value:e.userPopup.roles,callback:function(t){e.$set(e.userPopup,"roles",t)},expression:"userPopup.roles"}},e._l(e.rolelist,function(e){return n("el-option",{key:e.value,attrs:{label:e.name,value:e.name}})}))],1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.userPopup.visible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)])],1)},i=[],r=(n("f3/d"),n("Kw5r")),o=n("Nlzp"),l=n("QM0R"),s=function(e,t,n){console.log("invoke mobile rule",t),isNaN(t)||11!==t.length?n(new Error("请输入正确的手机号")):n()},u=function(e,t,n){var a=/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/g;t&&!a.test(t)?n(new Error("请输入正确的电子邮箱")):n()},c={data:function(){return{loading:!1,organization:{},role:"",loginName:"",rolelist:[],pager:{index:1,size:10,total:0},users:[],rules:{loginName:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"},{validator:function(e,t,n){o["a"].IOrganizationManager.existLoginName({loginName:t}).then(function(e){if(e)return n(Error("登录账号已存在"));n()}).catch(function(e){n(Error(e.message||"登录账号重复检测失败"))})},trigger:"blur"}],name:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"}],mobile:[{required:!0,validator:s,trigger:"blur"}],email:[{validator:u,trigger:"blur"}],roles:[{validator:function(e,t,n){if(console.log("invoke roles validator",t),!t.length)return n(Error("请选择角色"));n()},trigger:"blur"}]},userPopup:{visible:!1,id:null,loginName:"",name:"",mobile:"",email:"",roles:[],submitting:!1},updateRules:{loginName:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"}],name:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"}],mobile:[{required:!0,validator:s,trigger:"blur"}],email:[{validator:u,trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}]}}},computed:{user:function(){return this.$store.getters.user},access:function(){var e=this.$store.getters.access,t=e.ADD_MANAGER,n=e.UPDATE_MANAGER,a=e.REMOVE_MANAGER;return{add:t,update:n,remove:a}}},methods:{onValidate:function(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];(e=console).log.apply(e,["onValidate"].concat(n))},onRolesBlur:function(){console.log("blur")},getOrganizationDetails:function(){var e=this;o["a"].IOrganizationManager.getOrg({id:this.user.orgId}).then(function(t){e.organization=t})},getOrganizationSubAccounts:function(e,t){var n=this;this.loading||(this.loading=!0,o["a"].IOrganizationManager.getOrganizationSubUsers({role:this.role||null,loginName:this.loginName||null,page:e-1,size:t}).then(function(e){n.pager={index:e.number+1,size:e.size,total:e.totalElements},n.users=e.content}).catch(function(e){n.$message({type:"error",message:e.message||"获取子账号列表失败"})}).then(function(){n.loading=!1}))},getOrganizationRoles:function(){var e=this;o["a"].IOrganizationManager.getOrgRoles({userId:this.user.id}).then(function(t){e.rolelist=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取企业下人员角色信息失败"})})},save:function(){var e=this;this.userPopup.submitting||this.$refs.userForm.validate(function(t){if(t){var n=e.userPopup,a=n.id,i=n.loginName,r=n.name,l=n.mobile,s=n.email,u=n.roles;(null==a?o["a"].IOrganizationManager.addOrganizationSubUser({loginName:i,name:r,mobile:l,email:s,roles:u.join(",")}):o["a"].IOrganizationManager.updateOrganizationSubUser({id:a,loginName:i,name:r,mobile:l,email:s,roles:u.join(",")})).then(function(t){e.getOrganizationSubAccounts(1,e.pager.size),e.userPopup.visible=!1}).catch(function(t){e.$message({type:"error",message:t.message||(a?"修改":"添加")+"失败"})})}})},openAddUserPopup:function(){var e=this;this.userPopup={visible:!0,id:null,loginName:"",name:"",mobile:"",email:"",roles:[],submitting:!1},r["default"].nextTick(function(){return e.$refs.userForm.clearValidate()})},openEditUserPopup:function(e){var t=this;this.userPopup={visible:!0,id:e.id,loginName:e.loginName,name:e.name,mobile:e.mobile||"",email:e.email||"",roles:e.roleBeans.map(function(e){return e.name}),submitting:!1},r["default"].nextTick(function(){return t.$refs.userForm.clearValidate()})},openDeleteUserPopup:function(e){var t=this;this.$msgbox({type:"warning",title:"删除提示",message:"您确定要删除账号【"+e.name+"】?"}).then(function(){o["a"].IOrganizationManager.delteOrganizationSubUser({subId:e.id}).then(function(e){t.getOrganizationSubAccounts(t.pager.index),t.$message({type:"success",message:"删除成功"})}).catch(function(e){t.$message({type:"error",message:e.message||"删除失败"})})}).catch(function(e){return e})},openResetPasswordPopup:function(e){var t=this,n=this.$createElement;this.$msgbox({title:"重置密码",message:n("div",{style:"text-align:center; line-height:24px"},["您确认重置【",e.name,"】的登录密码吗?",n("br"),n("span",{style:"display:block; color:#e6a23c"},["该账户重置后的初始密码为“",e.name+"123","”"])])}).then(function(){o["a"].IUserService.resetPassword({loginName:e.loginName}).then(function(e){t.$message({type:"success",message:"密码重置成功"})}).catch(function(e){t.$message({type:"error",message:e.message||"密码重置失败"})})}).catch(function(e){return e})}},created:function(){this.getOrganizationDetails(),this.getOrganizationRoles(),this.getOrganizationSubAccounts(1,this.pager.size)},watch:{"userPopup.roles":function(){this.$refs.userForm&&this.$refs.userForm.validateField("roles",function(e){return e})}},filters:{time:l["a"]}},m=c,p=(n("MEv/"),n("KD3M"),n("KHd+")),g=Object(p["a"])(m,a,i,!1,null,"7515558c",null);t["default"]=g.exports}}]);