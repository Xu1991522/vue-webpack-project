(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[24],{"/FQn":function(e,t,n){},"2AAJ":function(e,t,n){},"9uPO":function(e,t,n){},Ncd3:function(e,t,n){"use strict";n("rGqo"),n("yt8O");var r=n("iv4g"),a=n("XJYT"),o=n("Nlzp"),i=function(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank");var n=document.body;t.style.display="none",n.appendChild(t),t.click(),n.removeChild(t)},l={taskNames:[],timeout:null},s=function e(){var t=Object(r["a"])(l.taskNames);Promise.all(t.map(function(e){return o["a"].ITaskManager.getTaskResult({name:e})})).then(function(e){if(t.length!==l.taskNames.length)return t;var n={};return e.forEach(function(e,r){1===e.process?i("/portal-srv/downLoadFile?fileUrl="+e.fileLocation):-1===e.process?Object(a["Notification"])({type:"error",message:"文件下载任务("+e.taskIdentify+")失败: "+e.errorMsg}):null===e.process||0===e.process?n[t[r]]=1:Object(a["Notification"])({type:"error",message:"未知的文件下载任务状态: "+e.process})}),t.filter(function(e){return n[e]})}).catch(function(e){return t}).then(function(n){t.length===l.taskNames.length&&n.length&&(l.taskNames=n,l.timeout=setTimeout(e,5e3))})},u=function(e){l.taskNames.push(e),l.timeout&&clearTimeout(l.timeout),s()},c=function(e){l.taskNames=l.taskNames.filter(function(t){return t!==e})},d={add:u,remove:c};t["a"]=d},PqKs:function(e,t,n){"use strict";var r=n("2AAJ"),a=n.n(r);a.a},QM0R:function(e,t,n){"use strict";var r=n("19FS"),a=function(e,t){return e?r["format"](e,t):"-"};t["a"]=a},hHZg:function(e,t,n){},iEnF:function(e,t,n){"use strict";var r=n("/FQn"),a=n.n(r);a.a},"u+hM":function(e,t,n){"use strict";var r=n("hHZg"),a=n.n(r);a.a},wUed:function(e,t,n){"use strict";var r=n("9uPO"),a=n.n(r);a.a},y7jC:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{on:{click:e.hideAllMenuparameters}},[n("div",{staticClass:"common-top-nav-rown"},[n("el-tabs",{model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[n("el-tab-pane",{attrs:{label:"月表",name:"month"}},[n("useage-pane",{attrs:{providers:e.providers,proxies:e.proxies,operators:e.operators,query:e.month.query},on:{search:function(t){return e.month.query=t},download:function(t){e.download("month",e.month.query)}}}),n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingMonth,expression:"loadingMonth"}],staticStyle:{width:"100%"},attrs:{data:e.month.result,"empty-text":"暂无相关卡信息"},on:{"header-contextmenu":function(t,n){return e.headerclick("month",t,n)}}},[e.menuparameters.month.selected.indexOf("月份")>-1?n("el-table-column",{attrs:{label:"月份",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("span",{staticStyle:{color:"#038ae3",cursor:"pointer"},on:{click:function(t){e.redirectToDailyFlow(r,e.month.query.date)}}},[e._v(e._s(e._f("time")(e.month.query.date,"yyyy-MM")))])]}}])}):e._e(),e.menuparameters.month.selected.indexOf("卡号")>-1?n("el-table-column",{attrs:{label:"卡号","min-width":e.month.result.every(function(e){return!e.cardNumber})?60:180},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.cardNumber||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("ICCID")>-1?n("el-table-column",{attrs:{label:"ICCID",width:e.month.result.every(function(e){return!e.iccid})?65:181},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(""===t.row.iccid||null===t.row.iccid?"-":t.row.iccid)+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("运营商")>-1?n("el-table-column",{attrs:{label:"运营商",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.operatorName||"-")+"\n              ")]}}])}):e._e(),e.internal&&e.menuparameters.month.selected.indexOf("供应商")>-1?n("el-table-column",{attrs:{label:"供应商",width:e.month.result.every(function(e){return!e.providerName})?70:140},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.providerName||"-")+"\n              ")]}}])}):e._e(),e.internal&&e.menuparameters.month.selected.indexOf("所属代理商")>-1?n("el-table-column",{attrs:{label:"所属代理商",width:e.month.result.every(function(e){return!e.proxyName})?110:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.proxyName||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("总流量（MB）")>-1?n("el-table-column",{attrs:{label:"总流量（MB）",width:e.month.result.every(function(e){return!e.total})?140:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.total||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("使用量（MB）")>-1?n("el-table-column",{attrs:{label:"使用量（MB）",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.used||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("剩余流量（MB）")>-1?n("el-table-column",{attrs:{label:"剩余流量（MB）",width:e.month.result.every(function(e){return!e.remainder})?140:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.remainder||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("已超流量（MB）")>-1?n("el-table-column",{attrs:{label:"已超流量（MB）",width:e.month.result.every(function(e){return!e.exceed})?140:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.exceed||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.month.selected.indexOf("使用占比")>-1?n("el-table-column",{attrs:{label:"使用占比",width:e.month.result.every(function(e){return!e.utilizationRate})?140:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.utilizationRate||"-")+"\n              ")]}}])}):e._e()],1),n("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.month.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.month.pager.size,total:e.month.pager.count},on:{"size-change":function(t){return e.handleSizeChange("month",t)},"current-change":function(t){return e.handleCurrentChange("month",t)}}})],1)],1),n("el-tab-pane",{attrs:{label:"日表",name:"daily"}},[n("useage-pane",{attrs:{providers:e.providers,proxies:e.proxies,query:e.daily.query,operators:e.operators},on:{search:function(t){return e.daily.query=t},download:function(t){e.download("daily",e.daily.query)}}}),n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingDaily,expression:"loadingDaily"}],staticStyle:{width:"100%"},attrs:{data:e.daily.result,"empty-text":"暂无相关卡信息"},on:{"header-contextmenu":function(t,n){return e.headerclick("daily",t,n)}}},[e.menuparameters.daily.selected.indexOf("月份")>-1?n("el-table-column",{attrs:{label:"月 份",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){t.row;return[e._v("\n                "+e._s(e._f("time")(e.daily.query.date,"yyyy-MM"))+"\n              ")]}}])}):e._e(),e.menuparameters.daily.selected.indexOf("卡号")>-1?n("el-table-column",{attrs:{label:"卡号","min-width":e.daily.result.every(function(e){return!e.cardNumber})?60:180},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.cardNumber||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.daily.selected.indexOf("ICCID")>-1?n("el-table-column",{attrs:{label:"ICCID",width:e.daily.result.every(function(e){return!e.iccid})?65:181},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(""===t.row.iccid||null===t.row.iccid?"-":t.row.iccid)+"\n              ")]}}])}):e._e(),e.menuparameters.daily.selected.indexOf("运营商")>-1?n("el-table-column",{attrs:{label:"运营商",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.operatorName||"-")+"\n              ")]}}])}):e._e(),e.internal&&e.menuparameters.daily.selected.indexOf("供应商")>-1?n("el-table-column",{attrs:{label:"供应商",width:e.daily.result.every(function(e){return!e.providerName})?70:140},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.providerName||"-")+"\n              ")]}}])}):e._e(),e.internal&&e.menuparameters.daily.selected.indexOf("所属代理商")>-1?n("el-table-column",{attrs:{label:"所属代理商",width:e.daily.result.every(function(e){return!e.proxyName})?100:160},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.proxyName||"-")+"\n              ")]}}])}):e._e(),e.menuparameters.daily.selected.indexOf("总流量（MB）")>-1?n("el-table-column",{attrs:{label:"总流量（MB）",width:e.daily.result.every(function(e){return!e.used})?115:120},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.used||"-")+"\n              ")]}}])}):e._e(),e._l(31,function(t){return e.menuparameters.daily.selected.indexOf(t)>-1?n("el-table-column",{key:t,attrs:{label:""+t,"min-width":e.daily.result.every(function(e){return!e.dailyCount[t]})?60:120},scopedSlots:e._u([{key:"default",fn:function(r){var a=r.row;return[n("span",[e._v(e._s(a.dailyCount[t]||"-"))])]}}])}):e._e()})],2),n("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.daily.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.daily.pager.size,total:e.daily.pager.count},on:{"size-change":function(t){return e.handleSizeChange("daily",t)},"current-change":function(t){return e.handleCurrentChange("daily",t)}}})],1)],1)],1)],1),n("Contextmenu",{attrs:{menuparameter:e.menuparameters.month},on:{selectedchanged:function(t){return e.selectedchanged("month",t)}}}),n("Contextmenu",{attrs:{menuparameter:e.menuparameters.daily},on:{selectedchanged:function(t){return e.selectedchanged("daily",t)}}})],1)},a=[],o=n("oyJW"),i=n("yT7P"),l=(n("pIFo"),n("rGqo"),n("iv4g")),s=n("Nlzp"),u=function(e,t,n){if(e===t)return[e];if(0===n)throw Error("unexpected step in range(start, end, step) {}, step === 0");var r=e>t;if(n||(n=r?-1:1),r&&n>0||!r&&n<0)throw Error("unexpected step in range(start, end, step) {}, start "+(r?"<":">")+" end, but step "+(r?">":"<")+" 0");var a=[],o=e;while(1){if(r&&o<t||!r&&o>t)break;a.push(o),o+=n}return a},c=u,d=n("Ncd3"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container--useage-pane"},[n("div",{staticClass:"condition__line"},[e.internal?n("el-select",{staticStyle:{width:"170px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.proxy,callback:function(t){e.proxy=t},expression:"proxy"}},[n("el-option",{key:"",attrs:{label:"全部代理商",value:""}}),e._l(e.proxies,function(e){return n("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})],2):e._e(),e.internal?n("el-select",{staticStyle:{width:"150px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.provider,callback:function(t){e.provider=t},expression:"provider"}},[n("el-option",{key:"",attrs:{label:"全部供应商",value:""}}),e._l(e.providers,function(e){return n("el-option",{key:e.value,attrs:{label:e.name+"("+e.enName+")-"+e.account,value:e.id}})})],2):e._e(),n("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}},[n("el-option",{key:"",attrs:{label:"全部运营商",value:""}}),e._l(e.operators,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2),n("el-date-picker",{staticStyle:{"vertical-align":"top",width:"120px","margin-right":"10px"},attrs:{type:"month",placeholder:"选择日期"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}}),n("el-input",{staticClass:"icon__input",attrs:{placeholder:"请输入卡号或ICCID"},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}}),n("el-button",{staticStyle:{"vertical-align":"top","margin-top":"3px"},attrs:{type:"primary",size:"small"},on:{click:e.search}},[e._v("\n      搜 索\n    ")]),n("el-button",{staticStyle:{float:"right","margin-top":"3px"},attrs:{type:"primary",size:"small"},on:{click:e.download}},[e._v("导出搜索结果")])],1)])},m=[],h=(n("OG14"),n("91GP"),n("yt8O"),n("RW0V"),function(e){return Object.keys(e).reduce(function(t,n){return Object(i["a"])({},t,Object(o["a"])({},n,e[n]||null))},{})}),f={props:{proxies:{type:Array,required:!0},providers:{type:Array,required:!0},operators:{type:Array,required:!0},query:{type:Object,required:!0}},data:function(){var e=this.query;return{number:e.number||"",provider:e.provider||"",proxy:e.proxy||"",operator:e.operator||"",date:e.date||"",advanced:!1}},computed:{internal:function(){return"ADMIN"===this.$store.getters.user.roleBean.label}},methods:{search:function(){var e=this.number,t=this.provider,n=this.proxy,r=this.operator,a=this.date;this.$emit("search",h({number:e,provider:t,proxy:n,operator:r,date:a}))},download:function(){this.$emit("download")}},watch:{query:function(e){Object.assign(this,{number:e.number||"",provider:e.provider||"",proxy:e.proxy||"",operator:e.operator||"",date:e.date||"",advanced:!1})}},created:function(){this.date=new Date,this.search()}},y=f,v=(n("wUed"),n("u+hM"),n("KHd+")),g=Object(v["a"])(y,p,m,!1,null,"7d67e9d0",null),b=g.exports,x=n("QM0R"),w={name:"cardUsedMountManage",data:function(){var e="ADMIN"===this.$store.getters.user.roleBean.label,t=c(1,31),n=["月份","卡号","ICCID","运营商"].concat(Object(l["a"])(e?["供应商","所属代理商"]:[]),["总流量（MB）","使用量（MB）","剩余流量（MB）","已超流量（MB）","使用占比"]),r=n.slice(),a=["月份","卡号","ICCID","运营商"].concat(Object(l["a"])(e?["供应商","所属代理商"]:[]),["总流量（MB）"],Object(l["a"])(t)),o=a.slice();return{loadingMonth:!0,loadingDaily:!0,type:"month",providers:[],proxies:[],operators:[{value:"CMCC",label:"中国移动"},{value:"UNICOM",label:"中国联通"},{value:"CNET",label:"中国电信"}],month:{pager:{index:1,size:10,count:0},query:{},result:[]},daily:{pager:{index:1,size:10,count:0},query:{},days:30,result:[]},menuparameters:{month:{show:!1,position:{clientX:0,clientY:0},list:n,selected:r},daily:{show:!1,position:{clientX:0,clientY:0},list:a,selected:o}}}},computed:{internal:function(){return"ADMIN"===this.$store.getters.user.roleBean.label}},methods:{getmaxlength:function(e,t,n){var r=0;return n.forEach(function(t){var n=e(t),a=n.replace(/[^0-9a-zA-Z]/g,"--").length;r=a>r?a:r}),t&&r<t.replace(/[^0-9a-zA-Z]/g,"--").length&&(r=t.replace(/[^0-9a-zA-Z]/g,"--").length),8*r+21},selectedchanged:function(e,t){this.menuparameters[e].selected=t},headerclick:function(e,t,n){this.menuparameters[e].position.clientX=n.clientX,this.menuparameters[e].position.clientY=n.clientY,this.menuparameters[e].show=!0,n.preventDefault()},hideAllMenuparameters:function(){this.menuparameters.month.show=!1,this.menuparameters.daily.show=!1},monthSearch:function(e,t,n){var r=this,a={page:e-1,size:t,proxyId:n.proxy||null,providerId:n.provider||null,operator:n.operator||null,month:+new Date(n.date),cardNumber:n.number};s["a"].ICardFlowManager.listMonthCardFlowPageOnCondition(a).then(function(e){var t=Math.pow(2,10);r.month.result=e.content.map(function(e){return Object(i["a"])({},e,{total:e.total?(e.total/t).toFixed(2):0,used:e.used?(e.used/t).toFixed(2):0,remainder:e.remainder?(e.remainder/t).toFixed(2):0,exceed:e.exceed?(e.exceed/t).toFixed(2):0})}),r.month.pager={index:e.number+1,size:e.size,count:e.totalElements}}).catch(function(e){r.$message({type:"error",message:e.message||"卡用量月表查询失败"})}).then(function(){r.loadingMonth=!1})},dailySearch:function(e,t,n){var r=this,a={page:e-1,size:t,proxyId:n.proxy||null,providerId:n.provider||null,operator:n.operator||null,month:+new Date(n.date),cardNumber:n.number};s["a"].ICardFlowManager.listDailyCardFlowPageOnCondition(a).then(function(e){var t=288e5,n=Math.pow(2,10),a=function(e){return e.reduce(function(e,r){return Object(i["a"])({},e,Object(o["a"])({},new Date(r.date+t).getDate(),r.count?(r.count/n).toFixed(2):0))},{})};r.daily.result=e.content.map(function(e){return Object(i["a"])({},e,{total:e.total?(e.total/n).toFixed(2):0,used:e.used?(e.used/n).toFixed(2):0,remainder:e.remainder?(e.remainder/n).toFixed(2):0,exceed:e.exceed?(e.exceed/n).toFixed(2):0,dailyCount:a(e.dailyCount||[])})}),r.daily.pager={index:e.number+1,size:e.size,count:e.totalElements}}).catch(function(e){r.$message({type:"error",message:e.message||"卡用量日表查询失败"})}).then(function(){r.loadingDaily=!1})},handleSizeChange:function(e,t){var n=this[e],r=n.pager,a=n.query;this[e+"Search"](r.index,t,a)},handleCurrentChange:function(e,t){var n=this[e],r=n.pager,a=n.query;this[e+"Search"](t,r.size,a)},redirectToDailyFlow:function(e,t){this.type="daily",this.daily.query={number:e.cardNumber,date:t}},download:function(e,t){var n,r=this,a=function(e){return{proxyId:e.proxy||null,providerId:e.provider||null,operator:e.operator||null,month:+new Date(e.date),cardNumber:e.number}};if("month"===e)n=s["a"].ICardFlowManager.excelMonthFlow(a(t));else{if("daily"!==e)throw Error("unexpected download type in download(type, query) {}");n=s["a"].ICardFlowManager.excelDailyFlow(a(t))}n.then(function(e){if(!e.fileUrl)return Promise.reject(Error(e.message));r.$message({type:"success",message:"文件下载任务已开启，文件生成后将提醒您下载"}),d["a"].add(e.fileUrl)}).catch(function(e){r.$message({type:"error",message:e.message||"文件生成失败"})})}},created:function(){var e=this;this.internal&&(s["a"].IProxyManager.listBriefProxies({}).then(function(t){e.proxies=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取代理商列表失败"})}),s["a"].IProviderManager.listBriefProviders({}).then(function(t){e.providers=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取供应商列表失败"})}))},watch:{"month.query":function(e){this.monthSearch(this.month.pager.index,this.month.pager.size,e)},"daily.query":function(e){this.dailySearch(this.daily.pager.index,this.daily.pager.size,e)}},filters:{time:x["a"]},components:{UseagePane:b}},_=w,k=(n("iEnF"),n("PqKs"),Object(v["a"])(_,r,a,!1,null,"499c8ea6",null));t["default"]=k.exports}}]);