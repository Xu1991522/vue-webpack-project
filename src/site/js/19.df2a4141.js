(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"6LN5":function(e,t,a){},Dblf:function(e,t,a){"use strict";var r=a("6LN5"),s=a.n(r);s.a},OCus:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BackButton"),a("el-form",{ref:"form",staticClass:"form__div",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"短信类型："}},[a("el-radio",{attrs:{label:"short"},model:{value:e.form.smsType,callback:function(t){e.$set(e.form,"smsType",t)},expression:"form.smsType"}},[e._v("短内容")])],1),a("el-form-item",{attrs:{label:"短信内容：",prop:"content"}},[a("el-input",{staticStyle:{width:"600px"},attrs:{type:"textarea",rows:4,placeholder:"请输入短信内容",debounce:300},on:{input:e.handleContentInput},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),e._e()],1),a("el-form-item",{attrs:{label:"添加号码："}},[a("el-radio-group",{model:{value:e.importType,callback:function(t){e.importType=t},expression:"importType"}},e._l(e.importTypes,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])})),"EXACT_IMPORT"===e.importType?a("div",[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"多个号码，用英文逗号隔开"},model:{value:e.searchedNumbers,callback:function(t){e.searchedNumbers=t},expression:"searchedNumbers"}}),a("el-button",{staticStyle:{margin:"4px 0 0 15px"},attrs:{type:"primary",size:"small"},on:{click:e.importCardsByCardNumbers}},[e._v("添加")])],1):"BATCH_IMPORT"===e.importType?a("div",{staticStyle:{height:"auto"}},[a("el-upload",{staticStyle:{float:"left"},attrs:{action:"/portal-srv/upload/cardsFile","show-file-list":!1,"before-upload":e.handleBeforeUpload,"on-progress":e.handleUploadProgress,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError}},[a("el-input",{staticStyle:{width:"300px"},attrs:{disabled:!0,value:e.file.name,placeholder:"仅支持上传单个Excel文件"}}),a("el-button",{staticClass:"confirm-button",staticStyle:{"margin-left":"15px"}},[e._v("+上传文件")])],1),a("a",{staticClass:"download",staticStyle:{margin:"4px 0 0 15px",float:"left"},attrs:{target:"_black",href:"./download/card__temp.xlsx"}},[e._v("下载模板")])],1):e._e(),a("div",{staticClass:"clear"}),a("div",{staticClass:"table__div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.panel.cards,"tooltip-effect":"dark","empty-text":"暂无数据"}},[a("el-table-column",{attrs:{prop:"msisdn",label:"卡号",width:"180"}}),a("el-table-column",{attrs:{prop:"operatorName",label:"运营商",width:"160"}}),a("el-table-column",{attrs:{prop:"operatorStatusDesc",label:"运营状态",width:"160"}}),a("el-table-column",{attrs:{label:"开卡时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("time")(t.row.openTime,"yyyy-MM-dd HH:mm:ss"))+"\n              ")]}}])}),a("el-table-column",{attrs:{label:"激活时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("time")(t.row.activeTime,"yyyy-MM-dd HH:mm:ss"))+"\n              ")]}}])})],1),a("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],layout:"total, sizes, prev, pager, next, jumper","current-page":e.panel.pager.index,"page-size":e.panel.pager.size,total:e.panel.pager.count},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),a("div",{staticClass:"clear"})],1)],1),a("el-form-item",[a("el-button",{staticClass:"confirm-button",staticStyle:{"margin-right":"18px"},on:{click:e.send}},[e._v("发送")]),a("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)},s=[],n=(a("f3/d"),a("KKXr"),a("Kw5r")),i=a("Nlzp"),l=(a("pIFo"),function(e){var t=/[\u4e00-\u9fa5|\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/g;return e.replace(t,"--").length}),o=l,c=a("QM0R"),u=function(e,t){var a=o(t);return a===t.length?Math.floor((e-a)/2):Math.floor(e/2-t.length)},m={name:"",data:function(){var e=120;return{loading:!1,form:{smsType:"short",content:"",limit:e},searchedNumbers:"",numbersPanel:{batchId:"",cards:[],pager:{index:1,size:10,count:0}},filesPanel:{batchId:"",cards:[],pager:{index:1,size:10,count:0}},rules:{content:[{required:!0,message:"请输入短信内容",trigger:"blur"}]},importType:"EXACT_IMPORT",importTypes:[{value:"EXACT_IMPORT",label:"确认添加"},{value:"BATCH_IMPORT",label:"文件添加"}],file:{name:"",progress:"",url:""},smsTargetMsisdnData:[]}},computed:{toCharSize:function(){return o},remnant:function(){var e=u(this.form.limit,this.form.content);return e<0?0:e},panel:function(){return"EXACT_IMPORT"===this.importType?this.numbersPanel:this.filesPanel}},methods:{handleContentInput:function(e){var t=this,a=this.form.limit;if(u(a,e)<0){var r=e.length,s=this.form.limit/2;n["default"].nextTick(function(){while(s<r){if(u(a,e.slice(0,s+1))<0)break;s++}t.form.content=e.slice(0,s)})}},importCardsByCardNumbers:function(){var e=this,t=this.searchedNumbers.trim();if(!t)return this.$message({type:"error",message:"请输入查询号码"});var a=t.split(/\s*,\s*/).map(function(e){return e.trim()});(this.numbersPanel.batchId?i["a"].ISmsManager.cancelSmsSendReq({batchId:this.numbersPanel.batchId}).catch(function(e){return e}):Promise.resolve()).then(function(){return i["a"].ISmsManager.importMsisdnsForSms({msisdns:a,exact:!0})}).then(function(t){e.numbersPanel.batchId=t.batchId,e.fetchImportedCards(1,e.numbersPanel.pager.size)}).catch(function(t){e.$message({type:"error",message:t.message||"发送号码查询失败"})})},importCardsByFiles:function(){var e=this;if(!this.file.name)return this.$message({type:"error",message:"请先上传文件"});var t=!this.file.url;if(t)return this.$message({type:"error",message:"请等待所有文件上传完成"});(this.filesPanel.batchId?i["a"].ISmsManager.cancelSmsSendReq({batchId:this.filesPanel.batchId}).catch(function(e){return e}):Promise.resolve()).then(function(){return i["a"].ISmsManager.importMsisdnsForSms({fileUrl:[e.file.url],exact:!1})}).then(function(t){e.filesPanel.batchId=t.batchId,e.fetchImportedCards(1,e.filesPanel.pager.size)}).catch(function(t){e.$message({type:"error",message:t.message||"发送号码查询失败"})})},send:function(){var e=this;this.$refs.form.validate(function(t){if(t){var a="EXACT_IMPORT"===e.importType?e.numbersPanel:e.filesPanel;if(!a.batchId||!a.pager.count)return e.$message({type:"error",message:"请添加号码"});i["a"].ISmsManager.listSmsCardTempInfo({batchId:a.batchId,page:0,size:a.pager.count}).then(function(t){var r={smsCategory:e.form.smsType,content:e.form.content,msisdns:t.smsTargetMsisdnList.content.map(function(e){return e.msisdn}),batchId:a.batchId};return i["a"].ISmsManager.confirmSmsSendReq(r)}).then(function(e){if(1e3!==e.code)return Promise.reject(Error(e.msg))}).then(function(){e.$message({message:"操作成功",type:"success"}),e.$router.back()}).catch(function(t){e.$message({type:"error",message:t.message||"发送失败"})})}})},cancel:function(){this.$router.back()},handleBeforeUpload:function(e){return this.file={name:e.name,progress:0,url:""},!0},handleUploadProgress:function(e,t){e.lengthComputable&&(this.file.progress=e.percent)},handleUploadSuccess:function(e,t){this.file.url=e,this.importCardsByFiles()},handleUploadError:function(e,t){this.$message({type:"error",message:e.message||"文件"+t.name+"上传失败"}),this.file={name:t.name,progress:0,url:""}},fetchImportedCards:function(e,t){var a=this;this.loading=!0;var r="EXACT_IMPORT"===this.importType?this.numbersPanel:this.filesPanel;i["a"].ISmsManager.listSmsCardTempInfo({batchId:r.batchId,page:e-1,size:t||r.pager.size}).then(function(e){var t=e.smsTargetMsisdnList;r.cards=t.content,r.pager={index:t.number+1,size:t.size,count:t.totalElements}}).catch(function(e){a.$message({type:"error",message:e.message||"号码查询失败"})}).then(function(){a.loading=!1})},handleCurrentChange:function(e){this.fetchImportedCards(e)},handleSizeChange:function(e){this.listSmsCardTempInfo(1,e)}},beforeDestroy:function(){this.numbersPanel.batchId&&this.numbersPanel.pager.count&&i["a"].ISmsManager.cancelSmsSendReq({batchId:this.numbersPanel.batchId}).catch(function(e){return e}),this.filesPanel.batchId&&this.filesPanel.pager.count&&i["a"].ISmsManager.cancelSmsSendReq({batchId:this.filesPanel.batchId}).catch(function(e){return e})},filters:{time:c["a"]}},f=m,d=(a("Dblf"),a("KHd+")),p=Object(d["a"])(f,r,s,!1,null,"73896d14",null);t["default"]=p.exports},QM0R:function(e,t,a){"use strict";var r=a("19FS"),s=function(e,t){return e?r["format"](e,t):"-"};t["a"]=s}}]);