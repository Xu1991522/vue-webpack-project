(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"It/d":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("BackButton"),n("div",{staticClass:"tab-con"},[n("div",{staticClass:"creatName"},[e._m(0),n("el-input",{staticClass:"roleIpt",attrs:{placeholder:"请输入角色名称"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),n("div",{staticClass:"userDefined"},[e._m(1),n("div",{staticClass:"userTableData"},[e.permissions.length?n("permissions-table",{attrs:{permissions:e.permissions,granted:e.granted,configurable:!0},on:{change:function(t){e.selected=t}}}):n("div",{staticStyle:{padding:"20px"}},[e._v("权限加载中...")])],1),n("div",{staticClass:"buttonCon"},[n("el-row",[n("el-button",{staticStyle:{"margin-right":"15px"},attrs:{type:"primary",size:"small"},on:{click:e.save}},[e._v(" 添加 ")]),n("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v(" 取消 ")])],1)],1)])])],1)},a=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("em",{staticClass:"mark"},[e._v("* ")]),e._v("角色名称")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("em",{staticClass:"mark"},[e._v("* ")]),e._v("配置权限")])}],i=(n("dRSK"),n("f3/d"),n("Nlzp")),s=n("VFj2"),l={name:"addRoles",data:function(){return{roles:[],role:{name:""},permissions:[],granted:[],selected:[],submitting:!1}},created:function(){var e=this;i["a"].IUserService.getAllRole({}).then(function(t){e.roles=t}),i["a"].IUserService.getAllMenuBeans({}).then(function(t){e.permissions=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取全部权限失败"})})},methods:{save:function(){var e=this;if(!this.submitting){var t=this.role.name.trim();if(!t)return this.$message({type:"error",message:"请填写角色名称"});var n=t.length;if(n>20)return this.$message({type:"error",message:"字符超过限制"});if(this.roles.find(function(e){return e.name===t}))return this.$message({type:"error",message:"重复的角色名称"});if(!this.selected.length)return this.$message({type:"error",message:"请配置角色权限"});this.submitting=!0,i["a"].IUserService.addRole({roleName:t,role:this.selected}).then(function(t){if(!t)return Promise.reject(Error("保存失败"));e.$router.back()}).catch(function(t){e.$message({type:"error",message:t.message})}).then(function(){e.submitting=!1})}},cancel:function(){this.$router.back()}},components:{permissionsTable:s["a"]}},o=l,c=(n("roPn"),n("KHd+")),u=Object(c["a"])(o,r,a,!1,null,"ea4a80d2",null);t["default"]=u.exports},VFj2:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data,"span-method":e.colspan,border:""}},[n("el-table-column",{attrs:{label:"一级菜单",width:"240",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"content-rowspan"},[e.configurable?n("el-checkbox",{attrs:{value:!!e.selected[t.row.parent.label]},on:{change:function(n){return e.select(t.row.parent,n)}}},[e._v("\n          "+e._s(t.row.parent.name)+"\n        ")]):n("span",[e._v(e._s(t.row.parent.name))])],1)]}}])}),n("el-table-column",{attrs:{label:"二级菜单",align:"left",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"content-rowspan"},[e.configurable&&!t.row.empty?n("el-checkbox",{attrs:{value:!!e.selected[t.row.label]},on:{change:function(n){return e.select(t.row,n)}}},[e._v("\n          "+e._s(t.row.name)+"\n        ")]):n("span",[e._v(e._s(t.row.empty?"无":t.row.name))])],1)]}}])}),n("el-table-column",{attrs:{label:"功能模块",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[!t.row.empty&&t.row.children.filter(function(e){return"4"!==e.category}).length?n("div",{staticClass:"content-rowspan"},[e.configurable?n("div",e._l(t.row.children.filter(function(e){return"4"!==e.category}),function(t){return n("el-checkbox",{key:t.id,attrs:{value:!!e.selected[t.label]},on:{change:function(n){return e.select(t,n)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])})):n("span",[e._v(e._s(t.row.children.filter(function(e){return"4"!==e.category}).map(function(e){return e.name}).join("、")))])]):n("div",{staticClass:"content-rowspan"},[e._v("无")])]}}])})],1)},a=[],i=(n("SRfc"),n("Vd3H"),n("iv4g")),s=n("yT7P"),l=(n("f3/d"),n("rE2o"),n("ioFf"),n("rGqo"),n("V4l9")),o=function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value,o={parent:"",id:l.id,name:l.name,label:"1-"+l.id,children:[]},c=!0,u=!1,d=void 0;try{for(var f,h=l.subMenu[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var m=f.value,p={parent:o,id:m.id,name:m.name,label:"2-"+m.id,children:[]},v=!0,b=!1,y=void 0;try{for(var g,w=m.authEntities[Symbol.iterator]();!(v=(g=w.next()).done);v=!0){var _=g.value;p.children.push({parent:p,id:_.id,name:_.name,label:"3-"+_.id,category:_.category,children:[]})}}catch(e){b=!0,y=e}finally{try{v||null==w.return||w.return()}finally{if(b)throw y}}o.children.push(p)}}catch(e){u=!0,d=e}finally{try{c||null==h.return||h.return()}finally{if(u)throw d}}l.subMenu.length||o.children.push({parent:o,empty:!0}),t.push(o)}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return t},c=function(e){var t={},n=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;t["1-"+l.id]=!0;var o=!0,c=!1,u=void 0;try{for(var d,f=(l.subMenu||[])[Symbol.iterator]();!(o=(d=f.next()).done);o=!0){var h=d.value;t["2-"+h.id]=!0;var m=!0,p=!1,v=void 0;try{for(var b,y=(h.authEntities||[])[Symbol.iterator]();!(m=(b=y.next()).done);m=!0){var g=b.value;t["3-"+g.id]=!0}}catch(e){p=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(p)throw v}}}}catch(e){c=!0,u=e}finally{try{o||null==f.return||f.return()}finally{if(c)throw u}}}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return t},u=function(e,t,n){var r={},a=function e(t){t.empty||(r[t.label]=!1,t.children.forEach(e))},i=function e(t){r[t.label]=!0,t.parent&&e(t.parent)};return n?i(e):a(e),Object(s["a"])({},t,r)},d=function(e,t){var n=[];return e.forEach(function(e){if(t[e.label]){var r={id:e.id,subMenu:[],authEntities:[]};n.push(r),e.children.forEach(function(e){if(t[e.label]){var n={id:e.id,subMenu:[],authEntities:[]};r.subMenu.push(n),e.children.forEach(function(e){t[e.label]&&n.authEntities.push({id:e.id,menu_id:n.id})})}})}}),n},f={name:"",props:{permissions:{type:Array,required:!0},granted:{type:Array,required:!0},configurable:{props:Boolean,default:!1}},data:function(){return{nodes:[],selected:{}}},computed:{data:function(){return Object(l["a"])(this.nodes.map(function(e){return e.children}))},colspan:function(){var e=function(e){return e[e.length-1]},t=this.nodes.reduce(function(t,n){var r=t.res,a=t.range,s=n.children.length;return{res:Object(i["a"])(r).concat([s]),range:Object(i["a"])(a).concat([e(a)+s])}},{res:[],range:[0]}),n=t.res,r=t.range;return function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(0===a){var i=r.indexOf(t);return i>-1?{rowspan:n[i],colspan:1}:{rowspan:0,colspan:0}}}}},methods:{setup:function(){var e=function(e){return e.sort(function(e,t){return e.sequence<t.sequence?-1:1})};this.nodes=o(e(this.permissions.map(function(t){return Object(s["a"])({},t,{subMenu:e((t.subMenu||[]).map(function(t){return Object(s["a"])({},t,{authEntities:e(t.authEntities||[])})}))})}))),this.selected=c(this.granted),this.$emit("change",d(this.nodes,this.selected))},select:function(e,t){var n=u(e,this.selected,t),r=[];e.label.match(/^1-/)&&t&&e.children.forEach(function(e){e.empty||(n=u(e,n,t),r.push(e))}),!e.empty&&e.label.match(/^2-/)&&t&&r.push(e),e.label.match(/^3-/)&&t&&r.push(e.parent),r.forEach(function(e){e.children.forEach(function(e){"4"===e.category&&(n=u(e,n,t))})}),this.selected=n}},created:function(){this.setup()},watch:{permissions:function(){this.setup()},granted:function(){this.setup()},selected:function(e){this.$emit("change",d(this.nodes,e))}}},h=f,m=n("KHd+"),p=Object(m["a"])(h,r,a,!1,null,null,null);t["a"]=p.exports},WWwe:function(e,t,n){},roPn:function(e,t,n){"use strict";var r=n("WWwe"),a=n.n(r);a.a}}]);