(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"6bmr":function(e,r,a){"use strict";a.r(r);var t=function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("div",[a("BackButton"),a("el-form",{ref:"ruleForm",staticClass:"iot__form form-pos",attrs:{"label-width":"120px",model:e.ruleForm,rules:e.rules,"label-position":"left"}},[a("div",{staticClass:"info-item"},[a("div",{staticClass:"inner-filt"},[e._v("企业信息")])]),a("el-form-item",{attrs:{label:"企业简称:",prop:"shortName"}},[a("el-input",{attrs:{placeholder:"请输入1-15个字符，创建后不可修改"},model:{value:e.ruleForm.shortName,callback:function(r){e.$set(e.ruleForm,"shortName","string"===typeof r?r.trim():r)},expression:"ruleForm.shortName"}})],1),a("el-form-item",{attrs:{label:"企业全称:",prop:"companyName"}},[a("el-input",{attrs:{placeholder:"请输入企业全称，与营业执照一致"},model:{value:e.ruleForm.companyName,callback:function(r){e.$set(e.ruleForm,"companyName","string"===typeof r?r.trim():r)},expression:"ruleForm.companyName"}})],1),a("el-form-item",{ref:"accessUrlItem",attrs:{label:"企业域名:",prop:"accessUrl"}},[a("el-radio-group",{on:{change:e.handleAccessTypeChange},model:{value:e.accessType,callback:function(r){e.accessType=r},expression:"accessType"}},[a("el-radio",{attrs:{label:"public"}},[e._v("公用域名")]),a("el-radio",{attrs:{label:"custom"}},[e._v("自定二级域名")]),a("el-radio",{attrs:{label:"private"}},[e._v("自有域名")])],1),"public"===e.accessType?[a("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.accessUrl,callback:function(r){e.$set(e.ruleForm,"accessUrl",r)},expression:"ruleForm.accessUrl"}})]:e._e(),"custom"===e.accessType?[a("el-input",{staticStyle:{width:"434px"},attrs:{placeholder:"请输入1-15个字符"},model:{value:e.ruleForm.accessUrl,callback:function(r){e.$set(e.ruleForm,"accessUrl","string"===typeof r?r.trim():r)},expression:"ruleForm.accessUrl"}}),e._v(".appmedia.cn\n      ")]:e._e(),"private"===e.accessType?[a("el-input",{model:{value:e.ruleForm.accessUrl,callback:function(r){e.$set(e.ruleForm,"accessUrl",r)},expression:"ruleForm.accessUrl"}})]:e._e()],2),a("el-form-item",{attrs:{label:"营业执照扫描件:"}},[a("el-upload",{staticClass:"upload__container upload--license",attrs:{name:"file","show-file-list":!1,action:"/portal-srv/upload/idcard","before-upload":e.handleBeforeUpload,"on-success":e.handleUploadSuccess("licenseUp"),"on-progress":e.handleUploadProgress("licenseUp"),"on-remove":e.handleRemove}},[e.images.licenseUp?a("img",{staticClass:"avatar",attrs:{src:e.images.licenseUp}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("div",{staticClass:"info-item"},[a("div",{staticClass:"inner-filt"},[e._v("联系人信息")])]),a("el-form-item",{attrs:{label:"姓名:",prop:"contact"}},[a("el-input",{attrs:{placeholder:"请输入联系人姓名",disabled:!1},model:{value:e.ruleForm.contact,callback:function(r){e.$set(e.ruleForm,"contact","string"===typeof r?r.trim():r)},expression:"ruleForm.contact"}})],1),a("el-form-item",{attrs:{label:"手机号:",prop:"mobile"}},[a("el-input",{attrs:{placeholder:"请输入手机号码",disabled:!1},model:{value:e.ruleForm.mobile,callback:function(r){e.$set(e.ruleForm,"mobile","string"===typeof r?r.trim():r)},expression:"ruleForm.mobile"}})],1),a("el-form-item",{attrs:{label:"身份证号码:",prop:"idCard"}},[a("el-input",{attrs:{maxlength:"18",placeholder:"请输入身份证号",disabled:!1},model:{value:e.ruleForm.idCard,callback:function(r){e.$set(e.ruleForm,"idCard","string"===typeof r?r.trim():r)},expression:"ruleForm.idCard"}})],1),a("el-form-item",{attrs:{label:"电话号码:",prop:"telephone"}},[a("el-input",{attrs:{placeholder:"请输入电话号码",disabled:!1},model:{value:e.ruleForm.telephone,callback:function(r){e.$set(e.ruleForm,"telephone","string"===typeof r?r.trim():r)},expression:"ruleForm.telephone"}})],1),a("el-form-item",{attrs:{label:"电子邮箱:",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入电子邮箱",disabled:!1},model:{value:e.ruleForm.email,callback:function(r){e.$set(e.ruleForm,"email","string"===typeof r?r.trim():r)},expression:"ruleForm.email"}})],1),a("el-form-item",{staticStyle:{"min-width":"800px"},attrs:{label:"证件图片:"}},[a("el-upload",{staticClass:"upload__container upload--up",attrs:{name:"file","show-file-list":!1,action:"/portal-srv/upload/idcard","before-upload":e.handleBeforeUpload,"on-success":e.handleUploadSuccess("up"),"on-progress":e.handleUploadProgress("up"),"on-remove":e.handleRemove}},[e.images.cardUp?a("img",{staticClass:"avatar",attrs:{src:e.images.up}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("el-upload",{staticClass:"upload__container upload--down",attrs:{action:"/portal-srv/upload/idcard",name:"file","show-file-list":!1,"before-upload":e.handleBeforeUpload,"on-success":e.handleUploadSuccess("down"),"on-progress":e.handleUploadProgress("down"),"on-remove":e.handleRemove}},[e.images.cardDown?a("img",{staticClass:"avatar",attrs:{src:e.images.down}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("el-upload",{staticClass:"upload__container upload--hand",attrs:{action:"/portal-srv/upload/idcard",name:"file","show-file-list":!1,"before-upload":e.handleBeforeUpload,"on-success":e.handleUploadSuccess("hand"),"on-progress":e.handleUploadProgress("hand"),"on-remove":e.handleRemove}},[e.images.cardHand?a("img",{staticClass:"avatar",attrs:{src:e.images.hand}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("div",{staticClass:"info-item"},[a("div",{staticClass:"inner-filt"},[e._v("账户信息")])]),a("el-form-item",{attrs:{label:"登录账号:",prop:"userInfo.loginName"}},[a("el-input",{attrs:{placeholder:"请输入1-20个字符，创建后不可修改",disabled:!1},model:{value:e.ruleForm.userInfo.loginName,callback:function(r){e.$set(e.ruleForm.userInfo,"loginName","string"===typeof r?r.trim():r)},expression:"ruleForm.userInfo.loginName"}})],1),a("el-form-item",{attrs:{label:"初始密码:",required:""}},["add"===this.handletype?a("el-input",{attrs:{value:e.ruleForm.userInfo.loginName+"123",placeholder:"请输入初始密码",disabled:!0}}):e._e(),"add"!==this.handletype?a("el-button",{staticStyle:{"vertical-align":"top"},attrs:{type:"primary"},on:{click:e.resetPassword}},[e._v("\n        重置密码\n      ")]):e._e()],1),a("el-form-item",{attrs:{label:"姓名:",prop:"userInfo.name"}},[a("el-input",{attrs:{placeholder:"请输入联系人姓名",disabled:!1},model:{value:e.ruleForm.userInfo.name,callback:function(r){e.$set(e.ruleForm.userInfo,"name","string"===typeof r?r.trim():r)},expression:"ruleForm.userInfo.name"}})],1),a("el-form-item",{attrs:{label:"手机号:",prop:"userInfo.mobile"}},[a("el-input",{attrs:{placeholder:"请输入手机号码",disabled:!1},model:{value:e.ruleForm.userInfo.mobile,callback:function(r){e.$set(e.ruleForm.userInfo,"mobile","string"===typeof r?r.trim():r)},expression:"ruleForm.userInfo.mobile"}})],1),a("el-form-item",{attrs:{label:"电子邮箱:",prop:"userInfo.email"}},[a("el-input",{attrs:{placeholder:"请输入电子邮箱",disabled:!1},model:{value:e.ruleForm.userInfo.email,callback:function(r){e.$set(e.ruleForm.userInfo,"email","string"===typeof r?r.trim():r)},expression:"ruleForm.userInfo.email"}})],1),a("el-form-item",{attrs:{label:"业务类型:",required:"",error:e.orgTypes.error}},[a("el-checkbox",{attrs:{disabled:e.distributorselected},model:{value:e.orgTypes.distributor,callback:function(r){e.$set(e.orgTypes,"distributor",r)},expression:"orgTypes.distributor"}},[e._v("渠道商账户")]),a("el-checkbox",{attrs:{disabled:e.brokerselected},model:{value:e.orgTypes.broker,callback:function(r){e.$set(e.orgTypes,"broker",r)},expression:"orgTypes.broker"}},[e._v("代理商账户")]),a("el-popover",{attrs:{placement:"top-start",trigger:"hover",width:"300"}},[a("div",[a("p",[e._v("渠道商账户：用于管理卡及套餐相关费用的账户")]),a("p",[e._v("代理商账户：用于给代理人佣金分成的账户")])]),a("i",{staticClass:"notice__icon",attrs:{slot:"reference"},slot:"reference"})])],1),a("el-form-item",{attrs:{label:"关联销售:",prop:"associateSale"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.associateSale,callback:function(r){e.$set(e.ruleForm,"associateSale",r)},expression:"ruleForm.associateSale"}},e._l(e.salespeople,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),a("el-form-item",{attrs:{label:"其他:"}},[a("el-checkbox",{model:{value:e.showbankinfo,callback:function(r){e.showbankinfo=r},expression:"showbankinfo"}},[e._v("添加银行卡信息")])],1),e.showbankinfo?a("el-form-item",{attrs:{label:"开户姓名:",prop:"accountName"}},[a("el-input",{attrs:{placeholder:"请输入开户姓名",disabled:!1},model:{value:e.ruleForm.accountName,callback:function(r){e.$set(e.ruleForm,"accountName","string"===typeof r?r.trim():r)},expression:"ruleForm.accountName"}})],1):e._e(),e.showbankinfo?a("el-form-item",{attrs:{label:"储蓄卡号:",prop:"debitAccount"}},[a("el-input",{attrs:{type:"text",maxlength:"23",placeholder:"请输入储蓄卡号",disabled:!1},on:{input:e.validateNum},model:{value:e.ruleForm.debitAccount,callback:function(r){e.$set(e.ruleForm,"debitAccount",r)},expression:"ruleForm.debitAccount"}})],1):e._e(),e.showbankinfo?a("el-form-item",{attrs:{label:"收款银行:",prop:"bankName"}},[a("el-input",{attrs:{placeholder:"请输入收款银行",disabled:!1},model:{value:e.ruleForm.bankName,callback:function(r){e.$set(e.ruleForm,"bankName","string"===typeof r?r.trim():r)},expression:"ruleForm.bankName"}})],1):e._e(),a("el-form-item",{staticStyle:{"margin-bottom":"40px"}},[a("el-button",{staticClass:"confirm-button",attrs:{loading:e.loading,disabled:e.disabled},on:{click:function(r){e.infohandle("change")}}},[e._v(e._s("添加新客户"===e.handletype?"添加":"保存"))]),a("el-button",{attrs:{disabled:e.disabled},on:{click:function(r){e.infohandle("cancel")}}},[e._v("取消")])],1)],1)],1)},o=[],l=a("k5N+"),s=(a("rGqo"),a("yt8O"),a("yT7P")),i=(a("SRfc"),a("pIFo"),a("Nlzp")),n=function(e,r,a){!r&&isNaN(r)||11!==r.length?a(new Error("请输入正确的手机号")):a()},c=function(e,r,a){r&&r.length>20?a(new Error("请输入1-20个字符")):a()},u=function(e,r,a){var t=/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/g;r&&!t.test(r)?a(new Error("请输入正确的电子邮箱")):a()},m=function(e,r,a){var t=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/g;r&&!t.test(r)?a(new Error("请输入正确的身份证号码")):a()},d=function(e,r,a){var t=/^([1-9]{1})(\d{15}|\d{18})$/;r&&!t.test(r.replace(/\s+/g,""))?a(new Error("请输入正确的银行卡号码")):a()},p={name:"",data:function(){var e=this;return{handletype:"",loading:!1,disabled:!1,showbankinfo:!1,distributorselected:!1,brokerselected:!1,images:{up:"",down:"",hand:"",license:""},urls:{up:"",down:"",hand:"",licenseUp:"",licenseDown:""},progress:{up:0,down:0,hand:0,licenseUp:0,licenseDown:""},salespeople:[],ruleForm:{companyName:"",shortName:"",accessUrl:"iot-cust.combmobile.org",licenseUp:"",licenceDown:"",contact:"",mobile:"",telephone:"",email:"",idCard:"",cardUp:"",cardDown:"",cardHand:"",userInfo:{loginName:"",name:"",mobile:"",email:""},orgCategory:"",isBroker:"",isDistributor:"",associateSale:"",accountName:"",debitAccount:"",bankName:""},orgTypes:{isDistributor:!1,isBroker:!1,error:""},accessType:"public",rules:{shortName:[{required:!0,message:"请输入1-15个字符",trigger:"blur"},{min:1,max:15,message:"请输入1-15个字符",trigger:"blur"},{validator:function(e,r,a){i["a"].IOrganizationManager.existOrgShortName({shortName:r}).then(function(e){if(e)return a(Error("企业简称已存在"));a()}).catch(function(e){a(Error(e.message||"企业简称重复检测失败"))})},trigger:"blur"}],accessUrl:[{validator:function(r,a,t){var o=e.accessType;if("public"===o)return t();if("custom"===o){var l=a.length;return l&&l<=15?t():t(Error("1-15个字符"))}if("private"===o)return a.match(/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/)?t():t(Error("企业域名不符合规范"));throw Error("unexpected accessType ["+o+"] when validate accessUrl")},trigger:"blur"}],companyName:[{required:!0,message:"请输入企业全称，与营业执照一致",trigger:"blur"}],contact:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"}],mobile:[{required:!0,validator:n,trigger:"blur"}],associateSale:[{required:!0,message:"请分配相关销售人员",trigger:"blur"}],idCard:[{validator:m,trigger:"blur"}],telephone:[{validator:c,trigger:"blur"}],email:[{validator:u,trigger:"blur"}],debitAccount:[{validator:d,trigger:"blur"}],userInfo:{loginName:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"},{validator:function(e,r,a){i["a"].IOrganizationManager.existLoginName({loginName:r}).then(function(e){if(e)return a(Error("登录账号已存在"));a()}).catch(function(e){a(Error(e.message||"登录账号重复检测失败"))})},trigger:"blur"}],name:[{required:!0,message:"请输入1-20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1-20个字符",trigger:"blur"}],mobile:[{required:!0,validator:n,trigger:"blur"}],email:[{validator:u,trigger:"blur"}]}}}},computed:{user:function(){return this.$store.getters.user},orgCategory:function(){return[this.orgTypes.distributor?"DISTRIBUTOR":"",this.orgTypes.broker?"BROKER":""].filter(function(e){return e}).join(",")}},methods:{infohandle:function(e){"cancel"===e?this.$router.back():this.submitForm("ruleForm")},handleAccessTypeChange:function(e){this.ruleForm.accessUrl="public"===e?"iot-cust.combmobile.org":"",this.$refs.accessUrlItem.clearValidate()},submitForm:function(e){var r=this;this.$refs[e].validate(function(e){var a=r.orgCategory;if(r.orgTypes.error=a?"":"请选择业务类型",a&&e){r.loading=!0,r.disabled=!0;var t="custom"===r.accessType?r.ruleForm.accessUrl+".appmedia.cn":r.ruleForm.accessUrl;"add"===r.handletype?i["a"].IOrganizationManager.addOrg({superOrg:r.user.orgId,org:Object(s["a"])({},r.ruleForm,{accessUrl:t,licenceUp:r.urls.licenceUp,licenceDown:r.urls.licenceDown,cardUp:r.urls.up,cardDown:r.urls.down,cardHand:r.urls.hand,orgCategory:a}),salerId:r.ruleForm.associateSale}).then(function(e){if(0!==e)return Promise.reject(Error("创建失败"));r.$message({type:"success",message:"创建成功"}),r.$router.back()}).catch(function(e){r.$message({type:"error",message:e.message||"创建失败"})}).then(function(){r.loading=!1,r.disabled=!1}):i["a"].IOrganizationManager.updateOrg({org:Object(s["a"])({},r.ruleForm,{accessUrl:t,licenceUp:r.urls.licenceUp,licenceDown:r.urls.licenceDown,cardUp:r.urls.up,cardDown:r.urls.down,cardHand:r.urls.hand,orgCategory:a}),salerId:r.ruleForm.associateSale}).then(function(e){if(0!==e)return Promise.reject(Error("修改失败"));r.$message({type:"success",message:"修改成功"}),r.$router.back()}).catch(function(e){r.$message({type:"error",message:e.message||"修改失败"})}).then(function(){r.loading=!1,r.disabled=!1})}})},handleUploadSuccess:function(e){var r=this;return function(a,t){r.images[e]=URL.createObjectURL(t.raw),r.urls[e]=a}},handleUploadProgress:function(e){var r=this;return function(a,t){a.lengthComputable&&(r.progress[e]=a.percent)}},handleRemove:function(e,r){console.log("handleRemove",e,r)},handleBeforeUpload:function(e){var r="image/jpeg"===e.type,a="image/png"===e.type,t=e.size/1024/1024<3;return r||a||this.$message.error("上传图片只支持png，jpeg格式"),t||this.$message.error("上传图片大小不能超过 3MB"),(r||a)&&t},validateNum:function(e){var r=this;this.$nextTick(function(){r.ruleForm.debitAccount=e.replace(/\s/g,"").replace(/[^\d]/g,"").replace(/(\d{4})(?=\d)/g,"$1 ")})},resetPassword:function(){var e=this;i["a"].IUserService.resetPassword({loginName:this.ruleForm.loginName}).then(function(){e.$message({type:"success",message:"密码重置成功"})}).catch(function(r){e.$message({type:"error",message:r.message||"密码重置失败"})})},setup:function(){var e=this,r=this.user.orgId,a=this.$route.query.org?+this.$route.query.org:null;this.handletype=a?"update":"add",a&&Promise.all([i["a"].IOrganizationManager.getOrg({id:a}),i["a"].IOrganizationManager.getAvailableAssociateSales({orgId:r,targetOrg:a})]).then(function(r){var a=Object(l["a"])(r,2),t=a[0],o=a[1];e.ruleForm=Object(s["a"])({},t,{loginName:t.userInfo.loginName,associateSale:o[0].id}),e.accessType="iot-cust.combmobile.org"===t.accessUrl?"public":t.accessUrl.match(/appmedia\.cn$/)?"custom":"private",e.urls={cardUp:t.cardUp||"",cardDown:t.cardDown||"",cardhand:t.cardHand||"",licenseUp:t.licenseUp||"",licenseDown:t.licenseDown||""},e.images=Object(s["a"])({},e.urls);var i=t.orgCategory.indexOf("DISTRIBUTOR")>-1,n=t.orgCategory.indexOf("BROKER")>-1;e.orgTypes={distributor:i,broker:n},e.distributorselected=i,e.brokerselected=n,e.showbankinfo=Boolean(t.bankName||t.accountName||t.debitAccount)}).catch(function(r){e.$message({type:"error",message:r.message||"企业信息获取失败"})}),i["a"].IOrganizationManager.getAvailableAssociateSales({orgId:r,targetOrg:null}).then(function(r){e.salespeople=r}).catch(function(r){e.$message({type:"error",message:r.message||"获取企业下销售人员列表失败"})})}},created:function(){this.setup()},watch:{orgCategory:function(e){this.orgTypes.error=e?"":"请选择业务类型"}}},g=p,f=(a("OpXp"),a("KHd+")),b=Object(f["a"])(g,t,o,!1,null,"7100c15f",null);r["default"]=b.exports},OpXp:function(e,r,a){"use strict";var t=a("fqj3"),o=a.n(t);o.a},fqj3:function(e,r,a){}}]);