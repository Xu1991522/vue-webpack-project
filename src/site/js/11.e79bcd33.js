(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"/4Xh":function(e,t,a){},"1+/l":function(e,t,a){},ERkc:function(e,t,a){"use strict";var s=a("1+/l"),r=a.n(s);r.a},SrKd:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"search"},[a("span",{staticClass:"input__label"},[e._v("企业简称：")]),a("el-select",{on:{change:e.search},model:{value:e.shortName,callback:function(t){e.shortName=t},expression:"shortName"}},[a("el-option",{attrs:{value:"",label:"全部企业"}}),e._l(e.shortNames,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.shortName}})})],2),a("el-button",{staticClass:"adder__btn",attrs:{type:"primary"},on:{click:function(t){t.stopPropagation(),e.adderVisible=!e.adderVisible}}},[e._v("添加客户")]),a("i",{staticStyle:{display:"block",clear:"both"}}),e.adderVisible?a("ul",{staticClass:"adder"},[a("li",{staticClass:"adder__item",on:{click:e.openAssociateDialog}},[e._v("关联已有代理商")]),a("li",{staticClass:"adder__item",on:{click:function(t){e.$router.push({path:"/organizations/detail",query:{title:"添加新客户"}})}}},[e._v("添加新客户")])]):e._e()],1),a("div",{staticClass:"el-table el-table--fit el-table--border el-table--group el-table--scrollable-x el-table--enable-row-hover el-table--enable-row-transition"},[a("table",{staticClass:"el-table__body org__list"},[e._m(0),a("tbody",e._l(e.items,function(t){return a("tr",{key:t.id,staticClass:"el-table__row"},[a("td",[e._v(e._s(t.shortName))]),a("td",[e._v(e._s(t.companyName))]),a("td",{on:{mouseenter:function(a){e.openContactDetail(a,t)},mouseleave:function(a){e.closeContactDetail(a,t)}}},[e._v("\n            "+e._s(t.contact)+"\n            "),a("i",{staticClass:"icon__contact"}),e.popover.visible&&t.id===e.popover.target.id?a("el-popover",{staticClass:"org-contact__popover",style:{zIndex:200,position:"fixed",left:e.popover.left+"px",top:e.popover.top+"px"},attrs:{placement:"left",width:"270"},model:{value:e.popover.visible,callback:function(t){e.$set(e.popover,"visible",t)},expression:"popover.visible"}},[a("p",{staticClass:"header"},[e._v("\n                "+e._s(e.popover.target.contact)+"\n              ")]),a("p",{staticClass:"item"},[a("span",{staticClass:"item__label"},[e._v("手机")]),e._v("\n                "+e._s(e.popover.target.mobile)+"\n              ")]),a("p",{staticClass:"item"},[a("span",{staticClass:"item__label"},[e._v("邮箱")]),e._v("\n                "+e._s(e.popover.target.email)+"\n              ")]),a("p",{staticClass:"item"},[a("span",{staticClass:"item__label"},[e._v("电话")]),e._v("\n                "+e._s(e.popover.target.telephone)+"\n              ")]),a("p",{staticClass:"item"},[a("span",{staticClass:"item__label"},[e._v("身份证号")]),e._v("\n                "+e._s(e.popover.target.idCard)+"\n              ")])]):e._e()],1),a("td",[e._v(e._s(t.userInfo.loginName))]),a("td",[t.accessUrl?a("a",{staticClass:"link",attrs:{href:t.accessUrl,target:"_blank"}},[e._v(e._s(t.accessUrl))]):a("span",[e._v("-")])]),a("td",[null!=e.relations[t.id].isDistributor?a("el-checkbox",{attrs:{value:e.relations[t.id].isDistributor,disabled:!0}},[e._v("渠道商")]):e._e(),null!=e.relations[t.id].isBroker?a("el-checkbox",{attrs:{value:e.relations[t.id].isBroker},on:{change:function(a){return e.toggleAblity(t,"isBroker",a)}}},[e._v("代理商")]):e._e()],1),a("td",[a("el-button",{staticStyle:{"font-size":"13px",padding:"0"},attrs:{type:"text"},on:{click:function(a){e.$router.push({path:"/organizations/detail",query:{title:"修改客户信息",org:t.id}})}}},[e._v("修改")])],1)])}))])]),a("el-dialog",{attrs:{title:"关联已有代理商",width:"420px",visible:e.form.visible,"custom-class":"associate-proxy__popup"},on:{close:function(t){e.form.visible=!1}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"企业ID","label-width":"70px",required:"",error:e.form.error}},[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入企业ID"},on:{input:e.searchOrganizationById},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),a("el-form-item",{attrs:{label:"企业简称","label-width":"70px",required:""}},[a("el-input",{staticStyle:{width:"250px"},attrs:{value:e.form.shortName||"企业简称",disabled:""}})],1),a("el-form-item",{attrs:{label:"关联销售","label-width":"70px",required:""}},[a("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择关联销售"},model:{value:e.form.salesperson,callback:function(t){e.$set(e.form,"salesperson",t)},expression:"form.salesperson"}},e._l(e.form.salespeople,function(e){return a("el-option",{key:e.id,attrs:{label:e.loginName,value:e.id}})}))],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.form.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.associateProxyOrganization}},[e._v("确认")])],1)],1)],1)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"el-table__row"},[a("th",[e._v("企业简称")]),a("th",[e._v("企业全称")]),a("th",[e._v("联系人")]),a("th",[e._v("关联销售")]),a("th",[e._v("企业网址")]),a("th",[e._v("业务关系")]),a("th",{staticStyle:{width:"100px"}},[e._v("操作")])])])}],i=a("k5N+"),o=(a("rGqo"),a("yt8O"),a("SRfc"),a("oyJW")),n=a("yT7P"),l=a("iv4g"),c=a("Kw5r"),p=a("Nlzp"),u=function(e){return function(t){var a;return function(){a&&clearTimeout(a);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];a=setTimeout.apply(void 0,[t,e].concat(r))}}},d=u,m={data:function(){return{shortName:"",shortNames:[],adderVisible:!1,items:[],relations:{},pager:{index:1,size:10,count:0},popover:{visible:!1,target:"",left:0,top:0},form:{visible:!1,id:"",salesperson:"",salespeople:[],error:"",submitting:!1}}},computed:{user:function(){return this.$store.getters.user}},methods:{fetchOrganizations:function(e,t){var a=this;p["a"].IOrganizationManager.listOrgsByConditions({superOrg:this.user.orgId,page:e-1,size:t,shortName:null}).then(function(e){var t=e.content.reduce(function(e,t){var a=e.items,s=e.relations;return{items:Object(l["a"])(a).concat([t.subOrg]),relations:Object(n["a"])({},s,Object(o["a"])({},t.subOrg.id,{isDistributor:t.isDistributor?Boolean(t.isDistributor):null,isBroker:t.isBroker?Boolean(t.isBroker):null}))}},{items:[],relations:{}}),s=t.items,r=t.relations;a.items=s,a.relations=r,a.pager={index:e.number+1,size:e.size,count:e.totalElements}}).catch(function(e){a.$message({type:"error",message:e.message||"获取企业列表失败"})})},search:function(e){var t=this;if(!e)return this.fetchOrganizations(1,this.pager.size);p["a"].IOrganizationManager.getOrg({id:e}).then(function(e){t.items=[e],t.pager={index:1,size:t.pager.size,count:1}})},toggleAblity:function(e,t,a){var s=this;p["a"].IOrganizationManager.updateAssociateBroker({currentOrgId:this.user.orgId,brokerId:e.id,operation:a?"RECOVER":"CANCEL"}).then(function(){var r=s.relations[e.id];c["default"].set(r,t,a)}).catch(function(e){s.$message({type:"error",message:e.message||"修改代理关系失败"})})},openContactDetail:function(e,t){if(t.id!==this.popover.target.id){var a,s=document.body.clientHeight,r=140;a=e.clientY+r<=s?e.clientY:s-r,this.popover={visible:!0,target:t,left:e.clientX+60,top:a}}},closeContactDetail:function(e,t){t.id===this.popover.target.id&&(this.popover={visible:!1,target:"",left:"",top:""})},openAssociateDialog:function(){var e=this;this.form={visible:!0,id:"",shortName:"",salesperson:"",salespeople:[]},p["a"].IOrganizationManager.getAvailableAssociateSales({orgId:this.user.orgId,targetOrg:null}).then(function(t){e.form.salespeople=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取销售人员列表失败"})})},associateProxyOrganization:function(){var e=this;p["a"].IOrganizationManager.addAssociateBroker({currentOrgId:1,brokerId:this.form.id,userId:this.form.salesperson}).then(function(t){e.form.visible=!1,e.fetchOrganizations(1,e.pager.size)}).catch(function(t){e.$message({type:"error",message:t.message||"关联代理商失败"})})},searchOrganizationById:function(e){var t=this;this.form.shortName="",this.form.error="",this.form.salesperson="",this.form.salespeople=[],e||(this.form.error="请输入代理商ID"),e.match(/\D/)&&(this.form.error="代理商ID不符合规范"),this.form.error||p["a"].IOrganizationManager.getBrokers({brokerId:+e}).then(function(e){return e?Promise.all([e,p["a"].IOrganizationManager.getAvailableAssociateSales({orgId:t.user.orgId,targetOrg:e.id})]):[e]}).then(function(a){var s=Object(i["a"])(a,2),r=s[0],o=s[1];e===t.form.id&&(r?(t.form.shortName=r.shortName,-1!==r.orgCategory.indexOf("BROKER")?t.form.salespeople=o:t.form.error="非代理商账户"):t.form.error="该代理商未找到")})}},created:function(){var e=this;p["a"].IOrganizationManager.getAllSubOrgs({}).then(function(t){e.shortNames=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取企业简称列表失败"})}),this.fetchOrganizations(1,this.pager.size),this.searchOrganizationById=d(1e3)(this.searchOrganizationById)},mounted:function(){var e=this;this.adder$=function(){e.adderVisible=!1},document.addEventListener("click",this.adder$)},beforeDestroy:function(){document.removeEventListener("click",this.adder$),this.adder$=null,this.searchOrganizationById=null}},h=m,f=(a("ERkc"),a("mIs5"),a("KHd+")),g=Object(f["a"])(h,s,r,!1,null,"f1a351ca",null);t["default"]=g.exports},mIs5:function(e,t,a){"use strict";var s=a("/4Xh"),r=a.n(s);r.a}}]);