(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{"8wgZ":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"common-top-nav-rown"},[a("el-tabs",{model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-tab-pane",{attrs:{label:"短信发送",name:"smsSend"}},[a("div",[a("label",{staticClass:"input__label",attrs:{for:""}},[e._v("发送时间")]),a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",editable:!1,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.smsCondition.startTime,callback:function(t){e.$set(e.smsCondition,"startTime",t)},expression:"smsCondition.startTime"}}),a("span",{staticStyle:{margin:"0 10px","line-height":"36px","font-size":"14px",color:"#606266"}},[e._v("至")]),a("el-date-picker",{staticStyle:{width:"150px"},attrs:{editable:!1,type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.smsCondition.endTime,callback:function(t){e.$set(e.smsCondition,"endTime",t)},expression:"smsCondition.endTime"}}),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",size:"small"},on:{click:e.handleSearch}},[e._v("\n            搜索\n          ")]),a("el-button",{staticStyle:{float:"right",margin:"4px 10px 0 0"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.$router.push({path:"/smsRecords/newSMS",query:{title:"新建短信"}})}}},[e._v("\n            新建短信\n          ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","max-height":"400px",overflow:"auto","margin-top":"15px"},attrs:{data:e.smsData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"发送批次",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.openSendBatchPopup(t.row)}}},[e._v(e._s(t.row.batchId))])]}}])}),a("el-table-column",{attrs:{prop:"category",label:"短信类型",width:"80"}}),a("el-table-column",{attrs:{label:"短信内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(null==t.row.content?"******":t.row.content)+"\n            ")]}}])}),a("el-table-column",{attrs:{label:"发送状态",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"#038ae3"}},[e._v(e._s(t.row.successNum))]),e._v("/"+e._s(t.row.totalNum))]}}])}),a("el-table-column",{attrs:{label:"发送时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("time")(t.row.sendTime,"yyyy-MM-dd HH:mm:ss"))+"\n            ")]}}])})],1),a("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.pager.size,total:e.pager.count},on:{"size-change":e.handleBatchListSizeChange,"current-change":e.handleBatchListCurrentChange}},[e._v(">\n        ")])],1),a("el-tab-pane",{attrs:{label:"短信接收",name:"smsReceive"}},[a("useage-pane",{attrs:{providers:e.providers,proxies:e.proxies,operators:e.operators}})],1)],1)],1),a("el-dialog",{attrs:{fullscreen:!1,visible:e.sendBatchPopup.visible,left:"",width:e.internal?"1280px":"1000px"},on:{close:function(t){e.sendBatchPopup.visible=!1}}},[a("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.sendBatchPopup.target)+"发送详情")]),a("div",{staticClass:"dialog__body"},[a("div",{staticClass:"search__div"},[e.internal?[a("label",{staticClass:"input__label",attrs:{for:""}},[e._v("供应商")]),a("el-select",{staticClass:"selectBox",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.sendBatchPopup.provider,callback:function(t){e.$set(e.sendBatchPopup,"provider",t)},expression:"sendBatchPopup.provider"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.providers,function(e){return a("el-option",{key:e.value,attrs:{label:e.name+"("+e.enName+")-"+e.account,value:e.id}})})],2)]:e._e(),e.internal?[a("label",{staticClass:"input__label",attrs:{for:""}},[e._v("代理商")]),a("el-select",{staticClass:"selectBox",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.sendBatchPopup.proxy,callback:function(t){e.$set(e.sendBatchPopup,"proxy",t)},expression:"sendBatchPopup.proxy"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.proxies,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})],2)]:e._e(),a("label",{staticClass:"input__label",attrs:{for:""}},[e._v("运营商")]),a("el-select",{staticClass:"selectBox",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.sendBatchPopup.operator,callback:function(t){e.$set(e.sendBatchPopup,"operator",t)},expression:"sendBatchPopup.operator"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.operators,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:e._f("operator")(t.value)}})})],2),a("label",{staticClass:"input__label",attrs:{for:""}},[e._v("发送状态")]),a("el-select",{staticClass:"selectBox",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.sendBatchPopup.sendStatus,callback:function(t){e.$set(e.sendBatchPopup,"sendStatus",t)},expression:"sendBatchPopup.sendStatus"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.sendStatuses,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:e._f("sendStatus")(t.value)}})})],2),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入卡号"},model:{value:e.sendBatchPopup.msisdn,callback:function(t){e.$set(e.sendBatchPopup,"msisdn",t)},expression:"sendBatchPopup.msisdn"}}),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.listSmsSendRecord(1,e.pager.size)}}},[e._v("\n          搜索\n        ")])],2),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.sendBatchPopup.loading,expression:"sendBatchPopup.loading"}],staticStyle:{width:"100%"},attrs:{data:e.sendBatchPopup.batchData}},[a("el-table-column",{attrs:{prop:"msisdn",label:"号码",width:"240px"}}),e.internal?a("el-table-column",{attrs:{label:"供应商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.supplierName)+"\n          ")]}}])}):e._e(),e.internal?a("el-table-column",{attrs:{label:"代理商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.clientName)+"\n          ")]}}])}):e._e(),a("el-table-column",{attrs:{prop:"operatorName",label:"运营商",width:"240px"}}),a("el-table-column",{attrs:{label:"发送状态",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("sendStatus")(t.row.smsSendStatusDesc))+"\n          ")]}}])}),a("el-table-column",{attrs:{label:"发送时间",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("time")(t.row.sendTime,"yyyy-MM-dd HH:mm:ss"))+"\n          ")]}}])})],1),a("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.sendBatchPopup.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.sendBatchPopup.pager.size,total:e.sendBatchPopup.pager.count},on:{"current-change":e.handleSendBatchPopupCurrentChange,"size-change":e.handleSendBatchPopupSizeChange}}),a("div",{staticStyle:{width:"0",height:"0",clear:"both"}})],1)])],1)},s=[],r=a("k5N+"),l=(a("rGqo"),a("yt8O"),a("Nlzp")),i=[{value:"CMCC"},{value:"CNET"},{value:"UNICOM"}],o=i,c=a("QM0R"),u=function(e){var t={CMCC:"中国移动",UNICOM:"中国联通",CNET:"中国电信"};return t[e]||e},p=u,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"search"},[e.internal?a("div",{staticClass:"item__control"},[a("span",{staticClass:"item__label"},[e._v("供应商")]),a("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.provider,callback:function(t){e.provider=t},expression:"provider"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.providers,function(e){return a("el-option",{key:e.value,attrs:{label:e.name+"("+e.enName+")-"+e.account,value:e.id}})})],2)],1):e._e(),e.internal?a("div",{staticClass:"item__control"},[a("span",{staticClass:"item__label"},[e._v("代理商")]),a("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.proxy,callback:function(t){e.proxy=t},expression:"proxy"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.proxies,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})],2)],1):e._e(),a("div",{staticClass:"item__control"},[a("span",{staticClass:"item__label"},[e._v("运营商")]),a("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.operators,function(t){return a("el-option",{key:t.value,attrs:{label:e._f("operator")(t.value),value:t.value}})})],2)],1),a("div",{staticClass:"item__control"},[a("span",{staticClass:"item__label"},[e._v("接收时间")]),a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",placeholder:"开始日期"},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),a("span",{staticClass:"time__spliter"},[e._v("至")]),a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",placeholder:"结束日期"},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1),a("el-input",{staticClass:"item__control",staticStyle:{width:"200px"},attrs:{placeholder:"请输入卡号"},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}}),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"15px"},attrs:{border:"",data:e.receivedRecords,"empty-text":"暂无数据"}},[a("el-table-column",{attrs:{label:"回复号码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.msisdn)+"\n      ")]}}])}),e.internal?a("el-table-column",{attrs:{label:"供应商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.supplierName)+"\n      ")]}}])}):e._e(),e.internal?a("el-table-column",{attrs:{label:"代理商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.clientName)+"\n      ")]}}])}):e._e(),a("el-table-column",{attrs:{label:"运营商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.operatorName)+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"短信内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(null==t.row.content?"******":t.row.content)+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"接收时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("time")(t.row.receiveTime,"yyyy-MM-dd HH:mm:ss"))+"\n      ")]}}])})],1),a("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.pager.size,total:e.pager.count},on:{"size-change":function(t){return e.fetchReceivedSmsRecords(e.query,1,t)},"current-change":function(t){return e.fetchReceivedSmsRecords(e.query,t,e.pager.size)}}})],1)},m=[],h=a("yT7P"),f={props:{providers:{type:Array,required:!0},proxies:{type:Array,required:!0},operators:{type:Array,required:!0}},data:function(){return{provider:"",proxy:"",operator:"",startTime:"",endTime:"",number:"",receivedRecords:[],pager:{index:1,size:10,count:0},query:{},loading:!1}},computed:{internal:function(){return"ADMIN"===this.$store.getters.user.roleBean.label}},methods:{fetchReceivedSmsRecords:function(e,t,a){var n=this;this.loading||(this.loading=!0,l["a"].ISmsManager.listSmsReceiveRecord(Object(h["a"])({},e,{page:t-1,size:a})).then(function(e){return 1e3===e.code?e.smsReceiveRecordBeanList||{number:t-1,size:a,content:[],totalElements:0}:Promise.reject(Error(e.msg))}).then(function(t){n.query=e,n.receivedRecords=t.content,n.pager={index:t.number,size:t.size,count:t.totalElements}}).catch(function(e){n.$message({type:"error",message:e.message||"查询短信接受记录失败"})}).then(function(){n.loading=!1}))},handleSearch:function(){var e={},t=this.internal,a=this.provider,n=this.proxy,s=this.operator,r=this.startTime,l=this.endTime,i=this.number;if(t&&(a&&(e.supplierId=a),n&&(e.clientId=n)),s&&(e.operator=s),r||l){var o=r?+new Date(r):0,c=l?+new Date(l):+new Date;if(o>c)return this.$message({type:"error",message:"时间间隔不符合规范"});e.startTime=o,e.endTime=c+864e5}i&&(e.msisdn=i),this.fetchReceivedSmsRecords(e,1,this.pager.size)}},created:function(){this.fetchReceivedSmsRecords({},1,this.pager.size)},filters:{time:c["a"],operator:p}},v=f,b=(a("f1A9"),a("KHd+")),_=Object(b["a"])(v,d,m,!1,null,"326761f0",null),g=_.exports,y={name:"smsRecords",data:function(){return{type:"smsSend",smsCondition:{startTime:"",endTime:""},loading:!1,smsData:[],pager:{index:1,size:10,count:0},sendBatchPopup:{visible:!1,target:"",provider:"",proxy:"",operator:"",sendStatus:"",msisdn:"",loading:!1,pager:{index:1,size:10,count:0},batchData:[]},providers:[],proxies:[],operators:o,sendStatuses:[{value:"SUCCESS"},{value:"ERR_OPID"},{value:"ERR_SOURCE"},{value:"ERR_TARGET"},{value:"ERR_MSG2LONG"},{value:"UNKNOWN"}]}},computed:{internal:function(){return"ADMIN"===this.$store.getters.user.roleBean.label}},methods:{fetchProvidersAndProxies:function(){var e=this;Promise.all([l["a"].IProviderManager.listBriefProviders({}),l["a"].IProxyManager.listBriefProxies({})]).then(function(t){var a=Object(r["a"])(t,2),n=a[0],s=a[1];e.providers=n,e.proxies=s}).catch(function(t){e.$message({type:t.message||"供应商，代理商，搜索条件加载失败"})})},handleSearch:function(){this.listSmsSendBatchInfo(1,this.pager.size)},listSmsSendBatchInfo:function(e,t){var a=this;if(!this.loading){var n=this.smsCondition,s=n.startTime,r=n.endTime,i={page:e-1,size:t};if(s||r){var o=s?+new Date(s):0,c=r?+new Date(r):+new Date;if(o>c)return this.$message({type:"error",message:"时间间隔不符合规范"});i.startTime=o,i.endTime=c+864e5}this.loading=!0,l["a"].ISmsManager.listSmsSendBatchInfo(i).then(function(a){return 1e3===a.code?a.smsBatchInfoList||{number:e-1,size:t,content:[],totalElements:0}:Promise.reject(Error(a.msg))}).then(function(e){a.smsData=e.content,a.pager={index:e.number+1,size:e.size,count:e.totalElements}}).catch(function(e){a.$message({type:"error",message:e.message||"发送批次查询失败"})}).then(function(){a.loading=!1})}},handleBatchListCurrentChange:function(e){this.listSmsSendBatchInfo(e,this.pager.size)},handleBatchListSizeChange:function(e){this.listSmsSendBatchInfo(1,e)},openSendBatchPopup:function(e){this.sendBatchPopup={visible:!0,target:e.batchId,operator:"",sendStatus:"",msisdn:"",loading:!0,pager:{index:1,size:10,count:0},batchData:[]},this.listSmsSendRecord(1,this.sendBatchPopup.pager.size)},listSmsSendRecord:function(e,t){var a=this;l["a"].ISmsManager.listSmsSendRecord({supplierId:this.sendBatchPopup.provider||null,clientId:this.sendBatchPopup.proxy||null,operator:this.sendBatchPopup.operator||null,sendStatus:this.sendBatchPopup.sendStatus||null,msisdn:this.sendBatchPopup.msisdn,batchId:this.sendBatchPopup.target,page:e-1,size:t}).then(function(a){return 1e3===a.code?a.smsSendRecordList||{number:e-1,size:t,content:[],totalElements:0}:Promise.reject(Error(a.msg))}).then(function(e){a.sendBatchPopup.loading=!1,a.sendBatchPopup.pager={index:e.number+1,size:e.size,count:e.totalElements},a.sendBatchPopup.batchData=e.content}).catch(function(e){a.$message({type:"error",message:e.message||"发送详情查询失败"})})},handleSendBatchPopupCurrentChange:function(e){this.listSmsSendRecord(e,this.sendBatchPopup.pager.size)},handleSendBatchPopupSizeChange:function(e){this.listSmsSendRecord(1,e)}},created:function(){this.internal&&this.fetchProvidersAndProxies(),this.listSmsSendBatchInfo(1,this.pager.size)},filters:{time:c["a"],operator:p,sendStatus:function(e){var t={SUCCESS:"成功",ERR_OPID:"运营商标识错误",ERR_SOURCE:"发送方地址错误",ERR_TARGET:"接收方手机号码错误",ERR_MSG2LONG:"短信内容超长",UNKNOWN:"未知"};return t[e]||t.UNKNOWN}},components:{UseagePane:g}},S=y,x=(a("byhb"),a("Wqbc"),Object(b["a"])(S,n,s,!1,null,"2c22361f",null));t["default"]=x.exports},DBKi:function(e,t,a){},EW7z:function(e,t,a){},QM0R:function(e,t,a){"use strict";var n=a("19FS"),s=function(e,t){return e?n["format"](e,t):"-"};t["a"]=s},Wqbc:function(e,t,a){"use strict";var n=a("EW7z"),s=a.n(n);s.a},bDr8:function(e,t,a){},byhb:function(e,t,a){"use strict";var n=a("DBKi"),s=a.n(n);s.a},f1A9:function(e,t,a){"use strict";var n=a("bDr8"),s=a.n(n);s.a}}]);