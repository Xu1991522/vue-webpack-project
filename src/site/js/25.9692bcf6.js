(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[25],{"3i9x":function(e,t,l){},"6tnm":function(e,t,l){"use strict";var i=l("3i9x"),r=l.n(i);r.a},QM0R:function(e,t,l){"use strict";var i=l("19FS"),r=function(e,t){return e?i["format"](e,t):"-"};t["a"]=r},tikU:function(e,t,l){"use strict";l.r(t);var i=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{on:{click:function(t){e.menuparameter.show=!1}}},[l("div",{staticClass:"common-top-nav-rown"},[l("div",{staticClass:"labelHead"},[l("label",{staticClass:"input__label",attrs:{for:""}},[e._v("供应商名称")]),l("el-select",{staticClass:"selectBox",staticStyle:{width:"150px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.provider,callback:function(t){e.provider=t},expression:"provider"}},[l("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.providers,function(e){return l("el-option",{key:e.id,attrs:{label:e.name+"("+e.enName+")-"+e.account,value:e.id}})})],2),l("label",{staticClass:"input__label",attrs:{for:""}},[e._v("运营商")]),l("el-select",{staticClass:"selectBox",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}},[l("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.operators,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2),l("label",{staticClass:"input__label",attrs:{for:""}},[e._v("库存状态")]),l("el-select",{staticClass:"selectBox",attrs:{placeholder:"请选择"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[l("el-option",{key:"",attrs:{label:"全部",value:""}}),e._l(e.statuses,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2),l("el-button",{staticStyle:{"margin-top":"3px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.listPageInWareHouseByCondition(1,e.pager.size)}}},[e._v("\n        查询\n      ")]),e.access.deliver&&Object.keys(e.multipleSelection).length>0?l("el-button",{staticStyle:{width:"150px","padding-left":"8px","font-size":"12px"},attrs:{disabled:Object.values(e.multipleSelection).some(function(e){return"待出库"!==e.status}),type:"primary",size:"small"},on:{click:e.openMultipleDeliverPopup}},[e._v("\n        批量出库 （已选择"),l("label",[e._v(e._s(Object.keys(e.multipleSelection).length))]),e._v("条）\n      ")]):e._e(),e.access.stock?l("el-button",{staticClass:"inStore",attrs:{type:"primary",size:"small"},on:{click:e.openFileStockPopup}},[e._v("\n        导卡入库\n      ")]):e._e(),e.access.deliver?l("el-button",{staticClass:"inStore",attrs:{type:"primary",size:"small"},on:{click:e.openFileDeliverPopup}},[e._v("\n        导卡出库\n      ")]):e._e()],1)]),l("Contextmenu",{attrs:{menuparameter:e.menuparameter},on:{selectedchanged:e.selectedchanged}}),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%","margin-top":"15px"},attrs:{border:"",data:e.cardStock,"tooltip-effect":"dark","empty-text":"暂无相关卡信息"},on:{"header-contextmenu":e.headerclick,"select-all":e.handleAllSelectionChange}},[e.access.deliver?l("el-table-column",{attrs:{type:"selection",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-checkbox",{key:t.row.iccid,attrs:{value:!!e.multipleSelection[t.row.iccid]},on:{change:function(l){e.toggleSelect(t.row)}}})]}}])}):e._e(),e.menuparameter.selected.indexOf("操作")>-1?l("el-table-column",{attrs:{label:"操作",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.access.deliver&&"已出库"!==t.row.cardStatusName?l("span",{staticStyle:{color:"#038ae3",cursor:"pointer"},on:{click:function(l){e.openSingleDeliverPopup(t.row)}}},[e._v("\n          出库\n        ")]):l("span",[e._v("-")])]}}])}):e._e(),e.menuparameter.selected.indexOf("卡号")>-1?l("el-table-column",{attrs:{width:e.cardStock.every(function(e){return""===e.cardNumber||null===e.cardNumber})?"60":"160",prop:"cardNumber",label:"卡号"}}):e._e(),l("el-table-column",{attrs:{prop:"iccid",label:"ICCID","min-width":e.cardStock.every(function(e){return""===e.iccid||null===e.iccid})?"60":"200"}}),e.menuparameter.selected.indexOf("供应商名称/账号")>-1?l("el-table-column",{attrs:{label:"供应商名称/账号","min-width":(e.cardStock.every(function(e){return""===e.providerName||null===e.providerName}),"160")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.providerName+"/"+t.row.account)+"\n      ")]}}])}):e._e(),e.menuparameter.selected.indexOf("运营商")>-1?l("el-table-column",{attrs:{width:"80",prop:"operatorName",label:"运营商"}}):e._e(),e.menuparameter.selected.indexOf("库存状态")>-1?l("el-table-column",{attrs:{prop:"cardStatusName",label:"库存状态",width:"80"}}):e._e(),e.menuparameter.selected.indexOf("开卡时间")>-1?l("el-table-column",{attrs:{label:"开卡时间",width:e.cardStock.every(function(e){return""===e.openDate||null===e.openDate})?"80":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("time")(t.row.openDate,"yyyy-MM-dd HH:mm:ss"))+"\n      ")]}}])}):e._e(),e.menuparameter.selected.indexOf("入库时间")>-1?l("el-table-column",{attrs:{label:"入库时间",width:e.cardStock.every(function(e){return""===e.putInDate||null===e.putInDate})?"80":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("time")(t.row.putInDate,"yyyy-MM-dd HH:mm:ss"))+"\n      ")]}}])}):e._e(),e.menuparameter.selected.indexOf("出库时间")>-1?l("el-table-column",{attrs:{label:"出库时间",width:e.cardStock.every(function(e){return""===e.deliverDate||null===e.deliverDate})?"80":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("time")(t.row.deliverDate,"yyyy-MM-dd HH:mm:ss"))+"\n      ")]}}])}):e._e()],1),l("el-pagination",{attrs:{background:"","page-sizes":[10,20,30,40,50],"current-page":e.pager.index,layout:"total, sizes, prev, pager, next, jumper","page-size":e.pager.size,total:e.pager.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),l("el-dialog",{attrs:{"show-close":"",title:"出库",fullscreen:!1,visible:e.singleDeliverPopup.visible,width:"500px",left:""},on:{close:function(t){e.singleDeliverPopup.visible=!1}}},[l("el-form",{staticStyle:{width:"90%",margin:"0 auto"}},[l("el-form-item",{attrs:{label:"iccid"}},[e._v("\n        "+e._s(e.singleDeliverPopup.target)+"\n      ")]),l("el-form-item",{attrs:{label:"选择代理"}},[l("el-select",{attrs:{filterable:"",placeholder:"请选择代理商"},model:{value:e.singleDeliverPopup.agent,callback:function(t){e.$set(e.singleDeliverPopup,"agent",t)},expression:"singleDeliverPopup.agent"}},e._l(e.agents,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),l("el-form-item",{attrs:{label:"计费类型"}},[l("el-radio-group",{model:{value:e.singleDeliverPopup.charge,callback:function(t){e.$set(e.singleDeliverPopup,"charge",t)},expression:"singleDeliverPopup.charge"}},e._l(e.charges,function(t){return l("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}))],1)],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.singleDeliverPopup.visible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.singleDeliver}},[e._v("出 库")])],1)],1),l("el-dialog",{attrs:{"show-close":"",title:"导卡出库",visible:e.multipleDeliverPopup.visible,width:"500px",left:""},on:{close:function(t){e.multipleDeliverPopup.visible=!1}}},[l("div",{staticStyle:{margin:"0 auto",width:"90%"}},[l("el-form",[l("el-form-item",{attrs:{label:"出库条数"}},[e._v("\n          "+e._s(Object.keys(e.multipleSelection).length)+" 张\n        ")]),l("el-form-item",{attrs:{label:"选择代理"}},[l("el-select",{attrs:{filterable:"",placeholder:"请选择代理商"},model:{value:e.multipleDeliverPopup.agent,callback:function(t){e.$set(e.multipleDeliverPopup,"agent",t)},expression:"multipleDeliverPopup.agent"}},e._l(e.agents,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),l("el-form-item",{attrs:{label:"计费类型"}},[l("el-radio-group",{model:{value:e.multipleDeliverPopup.charge,callback:function(t){e.$set(e.multipleDeliverPopup,"charge",t)},expression:"multipleDeliverPopup.charge"}},e._l(e.charges,function(t){return l("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}))],1)],1)],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.multipleDeliverPopup.visible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.multipleDeliver}},[e._v("出 库")])],1)]),l("el-dialog",{attrs:{"show-close":"",title:"导卡导卡出库",visible:e.fileDeliverPopup.visible,width:"500px",left:""},on:{close:function(t){e.fileDeliverPopup.visible=!1}}},[l("div",{staticStyle:{margin:"0 auto",width:"90%"}},[l("el-form",{ref:"form",attrs:{"label-position":e.labelPosition,"label-width":"80px",model:e.fileDeliverPopup}},[l("el-form-item",{attrs:{label:"下载模板"}},[l("a",{staticClass:"download",attrs:{target:"_black",href:"./download/temp_out_store.xlsx"}},[e._v("出库模板文件")])]),l("el-form-item",{attrs:{label:"添加文件"}},[l("el-upload",{attrs:{action:"/portal-srv/upload/cardsFile","file-list":e.fileDeliverPopup.files,"show-file-list":!1,"before-upload":e.handleBeforeUpload("deliver"),"on-progress":e.handleUploadProgress("deliver"),"on-success":e.handleUploadSuccess("deliver"),"on-error":e.handleUploadError("deliver")}},[l("el-input",{staticStyle:{width:"230px","margin-right":"10px"},attrs:{disabled:!0,value:e.files.deliver.name}}),l("el-button",{staticClass:"download",attrs:{size:"small",type:"text"}},[e._v("选择文件")])],1)],1),l("el-form-item",{attrs:{label:"选择代理"}},[l("el-select",{attrs:{filterable:"",placeholder:"请选择代理商"},model:{value:e.fileDeliverPopup.agent,callback:function(t){e.$set(e.fileDeliverPopup,"agent",t)},expression:"fileDeliverPopup.agent"}},e._l(e.agents,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),l("el-form-item",{attrs:{label:"计费类型"}},[l("el-radio-group",{model:{value:e.fileDeliverPopup.charge,callback:function(t){e.$set(e.fileDeliverPopup,"charge",t)},expression:"fileDeliverPopup.charge"}},e._l(e.charges,function(t){return l("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}))],1)],1)],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.fileDeliverPopup.visible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.fileDeliver}},[e._v("出 库")])],1)]),l("el-dialog",{attrs:{title:"导卡入库","show-close":"",visible:e.fileStockPopup.visible,width:"500px",left:""},on:{close:function(t){e.fileStockPopup.visible=!1}}},[l("div",{staticStyle:{width:"90%",margin:"0 auto"}},[l("el-form",[l("el-form-item",{attrs:{label:"下载模板"}},[l("a",{staticClass:"download",attrs:{target:"_black",href:"./download/temp_in_store.xlsx"}},[e._v(" 入库模板文件")])]),l("el-form-item",{attrs:{label:"添加文件"}},[l("el-upload",{attrs:{action:"/portal-srv/upload/cardsFile","file-list":e.fileStockPopup.files,"show-file-list":!1,"before-upload":e.handleBeforeUpload("stock"),"on-progress":e.handleUploadProgress("stock"),"on-success":e.handleUploadSuccess("stock"),"on-error":e.handleUploadError("stock")}},[l("el-input",{staticStyle:{width:"230px","margin-right":"10px","margin-left":"14px"},attrs:{disabled:!0,value:e.files.stock.name}}),l("el-button",{attrs:{size:"small",type:"text"}},[e._v("选择文件")])],1)],1),l("el-form-item",{attrs:{label:"选择供应商"}},[l("el-select",{attrs:{filterable:"",placeholder:"请选择供应商"},model:{value:e.fileStockPopup.provider,callback:function(t){e.$set(e.fileStockPopup,"provider",t)},expression:"fileStockPopup.provider"}},e._l(e.providers,function(e){return l("el-option",{key:e.id,attrs:{label:e.name+"("+e.enName+")-"+e.account,value:e.id}})}))],1)],1)],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.fileStockPopup.visible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.fileStock}},[e._v("入 库")])],1)])],1)},r=[],a=l("oyJW"),s=l("yT7P"),o=(l("rGqo"),l("yt8O"),l("RW0V"),l("f3/d"),l("Kw5r")),n=l("Nlzp"),u=l("QM0R"),c={name:"",data:function(){return{loading:!0,provider:"",providers:[],agent:"",agents:[],operator:"",operators:[{value:"CMCC",label:"中国移动"},{value:"UNICOM",label:"中国联通"},{value:"CNET",label:"中国电信"}],status:"",statuses:[{value:"WAITING_TO_DELIVER",label:"待出库"},{value:"DELIVERED",label:"已出库"},{value:"ABANDON",label:"已废弃"}],cardStock:[],pager:{index:1,size:10,count:0},multipleSelection:{},charges:[{label:"流量共享",value:"FLOW_SHARED"},{label:"单卡计费",value:"SINGLE_CARD"}],menuparameter:{show:!1,position:{},list:["操作","卡号","供应商名称/账号","运营商","库存状态","开卡时间","入库时间","出库时间"],selected:["操作","卡号","供应商名称/账号","运营商","库存状态","开卡时间","入库时间","出库时间"]},centerDialogVisible:!1,outDialogVisible:!1,labelPosition:"right",inStoreForm:{},singleDeliverPopup:{visible:!1,target:"",agent:"",charge:"",submitting:!1},multipleDeliverPopup:{visible:!1,agent:"",charge:"",submitting:!1},fileDeliverPopup:{visible:!1,agent:"",files:[],charge:"",submitting:!1},fileStockPopup:{visible:!1,files:[],provider:"",submitting:!1},files:{deliver:{name:"",progress:"",url:""},stock:{name:"",progress:"",url:""}}}},computed:{user:function(){return this.$store.getters.user},access:function(){var e=this.$store.getters.access,t=e.STOCK_CARDS,l=e.DELIVER_CARDS;return{stock:t,deliver:l}}},methods:{handleBeforeUpload:function(e){var t=this;return function(l){return t.files[e].name=l.name,!0}},handleUploadProgress:function(e){var t=this;return function(l,i){l.lengthComputable&&(t.files[e].progress=l.percent)}},handleUploadSuccess:function(e){var t=this;return function(l,i){t.files[e].url=l}},handleUploadError:function(e){var t=this;return function(l,i){t.$message({type:"error",message:l.message||"文件上传失败"}),t.files[e]={name:"",progress:"",url:""}}},openSingleDeliverPopup:function(e){this.singleDeliverPopup={visible:!0,target:e.iccid,agent:"",charge:"",submitting:!1}},singleDeliver:function(){var e=this;if(!this.singleDeliverPopup.submitting){var t=this.singleDeliverPopup,l=t.target,i=t.agent,r=t.charge;if(!i)return this.$message({type:"error",message:"请选择代理商"});if(!r)return this.$message({type:"error",message:"请选择计费类型"});this.singleDeliverPopup.submitting=!0,n["a"].ICardStoreManager.deliver({iccids:[l],proxyId:i,chargeType:r}).then(function(t){if(!t)return Promise.reject(Error(t));e.$message({type:"success",message:"操作成功"});var i=!!e.multipleSelection[l];i&&o["default"].delete(e.multipleSelection,l),e.singleDeliverPopup.submitting=!1,e.singleDeliverPopup.visible=!1,e.listPageInWareHouseByCondition(1,e.pager.size)}).catch(function(t){e.$message({type:"error",message:"操作失败"}),console.log(t),e.singleDeliverPopup.submitting=!1})}},openMultipleDeliverPopup:function(){this.multipleDeliverPopup={visible:!0,agent:"",charge:"",submitting:!1}},multipleDeliver:function(){var e=this;if(!this.multipleDeliverPopup.submitting){var t=this.multipleDeliverPopup,l=t.agent,i=t.charge;if(!l)return this.$message({type:"error",message:"请选择代理商"});if(!i)return this.$message({type:"error",message:"请选择计费类型"});this.multipleDeliverPopup.submitting=!0;var r=Object.keys(this.multipleSelection);n["a"].ICardStoreManager.deliver({iccids:r,proxyId:l,chargeType:i}).then(function(t){if(!t)return Promise.reject(Error(t));e.$message({type:"success",message:"操作成功"}),e.multipleSelection={},e.multipleDeliverPopup.submitting=!1,e.multipleDeliverPopup.visible=!1,e.listPageInWareHouseByCondition(1,e.pager.size)}).catch(function(t){e.$message({type:"error",message:"操作失败"}),console.log(t),e.multipleDeliverPopup.submitting=!1})}},openFileDeliverPopup:function(){this.fileDeliverPopup={visible:!0,agent:"",files:[],charge:"",submitting:!1},this.files.deliver={name:"",progress:"",url:""}},fileDeliver:function(){var e=this;if(!this.fileDeliverPopup.submitting){var t=this.files.deliver;if(!t.name)return this.$message({type:"error",message:"请添加文件"});if(!t.url)return this.$message({type:"error",message:"请等待文件上传完毕"});var l=this.fileDeliverPopup,i=l.agent,r=l.charge;if(!i)return this.$message({type:"error",message:"请选择代理商"});if(!r)return this.$message({type:"error",message:"请选择计费类型"});this.fileDeliverPopup.submitting=!0,n["a"].ICardStoreManager.deliverByFile({fileUrl:t.url,proxyId:i,chargeType:r}).then(function(t){if(!t)return Promise.reject(Error(t));e.$message({type:"success",message:"操作成功"}),e.fileDeliverPopup.submitting=!1,e.fileDeliverPopup.visible=!1,e.listPageInWareHouseByCondition(1,e.pager.size)}).catch(function(t){e.$message({type:"error",message:"操作失败"}),console.log(t),e.fileDeliverPopup.submitting=!1})}},openFileStockPopup:function(){this.fileStockPopup={visible:!0,files:[],provider:"",submitting:!1},this.files.stock={name:"",progress:"",url:""}},fileStock:function(){var e=this;if(!this.fileStockPopup.submitting){var t=this.files.stock;if(!t.name)return this.$message({type:"error",message:"请添加文件"});if(!t.url)return this.$message({type:"error",message:"请等待文件上传完毕"});var l=this.fileStockPopup.provider;if(!l)return this.$message({type:"error",message:"请选择供应商"});this.fileStockPopup.submitting=!0,n["a"].ICardStoreManager.putInByFile({fileUrl:t.url,providerId:l}).then(function(t){if(!t)return Promise.reject(t);e.$message({type:"success",message:"操作成功"}),e.fileStockPopup.submitting=!1,e.fileStockPopup.visible=!1,e.listPageInWareHouseByCondition(1,e.pager.size)}).catch(function(t){e.$message({type:"error",message:"操作失败"}),console.log(t),e.fileStockPopup.submitting=!1})}},selectedchanged:function(e){this.menuparameter.selected=e},listPageInWareHouse:function(e,t){var l=this;n["a"].ICardStoreManager.listPageInWareHouse({page:e-1,size:t}).then(function(e){l.loading=!1,l.cardStock=e.content,l.pager={index:e.number+1,size:e.size,count:e.totalElements}})},listPageInWareHouseByCondition:function(e,t){var l=this,i={page:e-1,size:t,providerId:this.provider||null,operator:this.operator||null,cardStoreStatus:this.status||null};n["a"].ICardStoreManager.listPageInWareHouseByCondition(i).then(function(e){l.cardStock=e.content,l.pager={index:e.number+1,size:e.size,count:e.totalElements},o["default"].nextTick(function(){l.cardStock.forEach(function(e){var t=!!l.multipleSelection[e.iccid];t&&l.$refs.multipleTable.toggleRowSelection(e,!0)})})}).catch(function(e){l.$message({type:"error",message:e.message||"获取库存信息失败"})})},handleAllSelectionChange:function(e){var t=this,l=e.reduce(function(e,t){return Object(s["a"])({},e,Object(a["a"])({},t.iccid,1))},{});this.cardStock.forEach(function(e){var i=e.iccid,r=!!l[i];r?o["default"].set(t.multipleSelection,i,{id:i,status:e.cardStatusName}):o["default"].delete(t.multipleSelection,i)})},toggleSelect:function(e){var t=e.iccid,l=this.multipleSelection[t];l?o["default"].delete(this.multipleSelection,t):o["default"].set(this.multipleSelection,t,{id:t,status:e.cardStatusName}),this.$refs.multipleTable.toggleRowSelection(e,!l)},headerclick:function(e,t){this.menuparameter.position.clientX=t.clientX,this.menuparameter.position.clientY=t.clientY,this.menuparameter.show=!0,t.preventDefault()},fetchProviders:function(){var e=this;n["a"].IProviderManager.listBriefProviders({}).then(function(t){e.providers=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取供应商选项失败"})})},fetchAgents:function(){var e=this;n["a"].IProxyManager.getOnlyFirstProxylist({proxyId:this.user.id}).then(function(t){e.agents=t}).catch(function(t){e.$message({type:"error",message:t.message||"获取代理商选项失败"})})},handleCurrentChange:function(e){this.listPageInWareHouseByCondition(e,this.pager.size)},handleSizeChange:function(e){this.listPageInWareHouseByCondition(1,e)}},created:function(){this.listPageInWareHouse(1,this.pager.size),this.fetchProviders(),this.fetchAgents()},filters:{time:u["a"]}},p=c,d=(l("6tnm"),l("KHd+")),m=Object(d["a"])(p,i,r,!1,null,"7c3951a7",null);t["default"]=m.exports}}]);